FILE "gd1.akm"            ' 0 - Music (exported from Arkos Tracker 2)
FILE "gd1.akx"            ' 1 - Sound Effects (expord from Arkos Tracker 2)

FILE "TILES.chr.plet5"  ' 2 - Tiles Patterns (exported from nMSXTiles)
FILE "TILES.clr.plet5"  ' 3 - Tiles Colors (exported from nMSXTiles)

FILE "S8.SPR"           ' 4 - Sprites (exported from TinySprite)

FILE "TELA1.plet5"      ' 5 - Tela 1 
FILE "TELA2.plet5"      ' 6 - Tela 2 
FILE "TELA3.plet5"      ' 7 - Tela 3
FILE "TELA4.plet5"      ' 8 - Tela 4
FILE "TELA5.plet5"      ' 9 - Tela 5
FILE "TELA6.plet5"      '10 - Tela 6
FILE "TELA7.plet5"      '11 - Tela 7
FILE "TELA8.plet5"      '12 - Tela 8
FILE "TELA9.plet5"      '13 - Tela 9
FILE "TELA10.plet5"     '14 - Tela 10
FILE "TELA11.plet5"     '15 - Tela 11
FILE "TELA12.plet5"     '16 - Tela 12
FILE "TELA13.plet5"     '17 - Tela 13
FILE "TELA14.plet5"     '18 - Tela 14
FILE "TELA15.plet5"     '19 - Tela 15
FILE "TELA16.plet5"     '20 - Tela 16
FILE "TELA17.plet5"     '21 - Tela 17

0 '
11 X%=8:Y%=79:TY%=12:S%=0  'POISICAO INICIAL DO JOGADOR
12 DX%=8:S%=0         'POSIÇÃO INICIAL CANTO ESQUERDA - VIRADO PARA DIREITA
13 RP%=16:CP%=31      'ABRE PORTÃO
14 SC%=0              'SCORE Score
15 DIM MXY%(10,2) 'MOEDA
16 DIM OBP%(10,2) 'CHAVE
17 DIM POR%(150,2) 'PORTÃO MEMORIAZA PORTÕES ABERTOS - SER TIVER MAIS DE 150 TELAS O PROGRAMA MOSTRARÁ UM RISCO DO PORTAL NUMA POSIÇÃO ALEATÓRIA
18 DIM ALI%(10,5)
19 X11%=1:Y11%=12:JX%=1:T11%=TIME 'PLATAFORMA

10 GOSUB 10000       'INICIALIZA GAME
20 GOSUB 10200       'DEFINE VARIÁVEIS INICIAIS
30 X%=8:GOTO  10570       'INICIALIZA JOGO TELA 1
'30 X%=24:Y%=151:TY%=21:S%=0:GOTO  11110       'INICIALIZA JOGO TELA 6
'30 GOTO  11200       'INICIALIZA JOGO TELA 7
':Y%=71:
'30 X%=24:Y%=71:TY%=11:GOSUB 10900:GOTO 10420
'30 X%=24:Y%=71:TY%=11:GOTO 10940
'30 X%=24:TY%=16:Y%=((TY%*8)-16)-1:GOSUB 10940:GOTO 10420

'Y%=111


'===>GET USER INPUT
9100 K% = INKEY
9101 J% = STICK(0) OR STICK(1)
9102 B% = STRIG(0) OR STRIG(1)
9105 RETURN
 
'===>EXIBE JOGADOR
'9200 IF JP%>0 THEN IF DI%=-1 THEN S%=6 ELSE S%=3 '**** DEFINE O SPRITE NO PULO
9200 IF JP%>0 THEN IF DI%=-1 THEN S%=24 ELSE S%=21 '**** DEFINE O SPRITE NO PULO
9201 PUT SPRITE  0,(X%,Y%), 5,S%  'COR AZUL
9202 PUT SPRITE  1,(X%,Y%), 9,S%+1 'COR BRANCA
9203 PUT SPRITE  2,(X%,Y%),15,S%+2 'COR PELE

9204 'LOCATE 0,0:PRINT "                                                   " : LOCATE 0,0:PRINT "X:",X%,"-TX",X%/8,"/Y:",Y%,"-TY:",TY%,"-TL",TL%-4,"US",US%
9205 IF F%=1 THEN RETURN
9206 RX%=X%/8:RY%=TY%:CF%=TILE(RX%,TY%):CF2% = TILE(RX%+1,TY%) 'TILE PISO 
9207 GOSUB 9400  'controle queda 
9210 RETURN

'**********************************************************************************************/
' ** MOVIMENTO DO JOGADOR
'**********************************************************************************************/
9300 IF ST%=1                       THEN RETURN 'SE TIVER EM QUEDA NÃO MOVIMENTA AS SETAS

'PULO

9320 DT%=TIME-T1%:IF DT%<7          THEN RETURN ELSE T1%=TIME 'TIME
'SOBE
9321 IF J%=1                        THEN GOSUB 3300:RETURN 'SOBE
'DESCE
9322 IF J%=5                       THEN GOSUB 4000:RETURN  'DESCE
'9334 IF JP%=0 AND US%<>1          THEN IF B%<>0 THEN JP%=6:SE%=1:SD%=1:T1%=TIME:RETURN           'PULO

9334 IF JP%=0 AND US%<>1          THEN IF B%<>0 THEN  9741 'JP%=6:SE%=1:SD%=1:T1%=TIME:RETURN           'PULO

9325 IF J%=3 AND SD%=1  AND US%<>1 THEN SE%=1:GOSUB 9360:RETURN 'DIREITA
9326 IF J%=7 AND SE%=1  AND US%<>1 THEN SD%=1:GOSUB 9350:RETURN 'ESQUERDA
9327 IF J%=0 AND (S%<>0 OR S%<>9)   THEN GOSUB 9460:RETURN  'DEFINE POSIÇÃO SENTIDO
9340 RETURN


9741 IF TILE(RX%-1,RY%-3)=128 THEN 9744  'TOP PERSONAGEM
9743 JP%=6:SE%=1:SD%=1
9744 RETURN 

'**********************************************************************************************/

'**********************************************************************************************/
'MOVE ESQUERDA
'**********************************************************************************************/
9350 GOSUB 9700 'VERIFICA SE HÁ PAREDE DO LADO ESQUERDO
9352 IF SE%=0 THEN SE%=1:RETURN
9353 DI%=-1:DX% =-8:X%=X%+DX%:IF S%=6 THEN S%=9 ELSE S%=6 
9354 IF TILE(RX%,RY%-1)=169 THEN GOSUB 9880 'SAIDA PORTAL
9355 GOSUB 9200 'EXIBE JOGADOR

'=== VERIFICA SE HÁ PAREDE OU PORTÃO DO LADO ESQUERDO -  BLOCO VERMELHO
9700 IF RX%<1 THEN 10700  'GOSUB  9375  'SAI À ESQUERDA
9701 XT%=TILE(RX%-1,RY%-1) 'PÉ
9702 XU%=TILE(RX%-1,RY%-2) 'VER MOEDA - NARIZ
9703 IF XU%=128 OR XT%=128 OR XT%=138 OR XT%=149 OR XT%=148 OR XT%=168 OR XT%=170 OR XT%=157 THEN SE%=0:RETURN   'BLOCO VERMELHO (PAREDE) 157-PORTAL VERDE

9704 PX%=RX%-1:PY%=RY%-2
9711 IF XU%=172 THEN 8700 'PEGA CHAVE
9712 IF XU%=147 THEN 8620 'PEGA MOEDA

 'PEGA MOEDA
9714 IF XU%=201 THEN SE%=0:GOTO 8800 'ALAVANCA
9715 IF XT%=156 THEN FE%=1 'ATIVA ESPETO
9716 IF XU%=180 AND FM%=1  THEN 9000 'ABRE O PORTÃO
9719 RETURN 
'**********************************************************************************************/

'**********************************************************************************************/
'MOVE DIREITA
'**********************************************************************************************/
9360 GOSUB 9720 'VERIFICA A DIREITA
9363 IF SD%=0 THEN SD%=1:RETURN
9366 DI%=1:DX%=8:X%=X%+DX%:IF S%=3 THEN S%=0 ELSE S%=3 
9367 IF TILE(RX%+1,RY%-1)=169 THEN GOSUB 9880 'SAIDA PORTAL
9368 GOTO 9200 'EXIBE JOGADOR
 
'=== VERIFICA SE HÁ PAREDE OU PORTÃO DO LADO DIREITO -  BLOCO VERMELHO
'9720 IF RX%>30 THEN 9730     'SAI A DIREITA
9720 IF RX%+1>30 THEN 10712  'SAI A DIREITA 'GOSUB 9730     'SAI A DIREITA
9721 XT%=TILE(RX%+2,RY%-1)   'PÉ
9723 XU%=TILE(RX%+2,RY%-2): XT2%=TILE(RX%+2,RY%-1) ': LOCATE 0,2:PRINT XT2%  'PÉ

9724 IF XT2%=138 OR XT%=170 OR XT%=166 OR XT%=148 OR XT%=149 OR XT%=138 THEN SD%=0:RETURN 'BLOCO VERMELHO (PAREDE)
9725 PX%=RX%+2:PY%=RY%-2
9381 IF XU%=172            THEN GOSUB 8700 'PEGA CHAVE
9382 IF XU%=180 AND FM%=1  THEN 9000 'ABRE O PORTÃO
9726 IF XU%=147            THEN 8620 'PEGA MOEDA
9727 IF XU%=221            THEN SD%=0:GOTO 8800 'ALAVANCA
'9728 IF TILE(RX%+3,RY%-1)=130 AND FM%=1 THEN 11080 'ABRE BAÚ
9729 RETURN 

'=== VER SE TEM SAÍDA A DIREITA
'9741 IF RX%+1>30 THEN 10712 
'9750 RETURN
'**********************************************************************************************/

'**********************************************************************************************/
' CONTROLE DA QUEDA
'**********************************************************************************************/
9400 IF US%=1 THEN RETURN  ' SUBINDO ESCADA

'PLATAFORMA
9401 IF CF%=152 OR CF2%=152   THEN GOSUB 9440:RETURN

9402 IF CF%<>138 AND CF2%<>138 AND CF%<>149 AND CF2%<>149 AND CF%<>148 AND CF2%<>148 AND CF%<>188 AND CF2%<>188 AND CF%<>189 AND CF2%<>189 AND CF%<>128 AND CF2%<>128 AND CF%<>129 AND CF2%<>129  AND JP%=0 THEN GOSUB 9420 ELSE GOSUB 9440  '=== VERIFICA PISO
9404 IF CF%=135 OR CF2%=135 OR CF%=186 OR CF2%=186 THEN 3090 ' CAIU NO RIO
9410 RETURN

'=== QUEDA LIGADA
9420 Q%=8:ST%=1
9430 RETURN

'=== QUEDA DESLIGADA
9440 IF ST%=0 THEN RETURN
9441 Q%=0:ST%=0 
'=== NO FINAL DA QUEDA IDENTIFICA OS CARACTERES A DIREITA E A ESQUEDA
'9442 DR%=TILE(RX%+2,RY%-2):IF DR%=152  THEN SD%=0 ELSE SD%=1
'9444 ES%=TILE(RX%-1,RY%-2):IF ES%=152  THEN SE%=0 ELSE SE%=1
9450 RETURN

'=== QUEDA LIVRE
9500 IF TIME-VQ%<4 OR Q%=0 THEN RETURN  ' CONTROLA VELOCIDADE DA QUEDA
9502 VQ%=TIME
9510 GOSUB 9400 'CONTROLE DA QUEDA
9520 IF Q%=0 THEN RETURN
9522 GOSUB 9460 'CAI EM PÉ
9530 Y%=Y%+Q%:TY%=TY%+ST%
9590 RETURN
'**********************************************************************************************/

'**********************************************************************************************/
'PULO
'**********************************************************************************************/
9600 IF TIME-T16%<5 OR JP%=0 THEN RETURN 
9602 T16%=TIME
9620 JP%=JP%-1                           
9630 IF JP% > 3 THEN Y%=Y%-8:TY%=TY%-1
9631 IF JP% < 1 THEN Y%=Y%+8:TY%=TY%+1
9641 GOTO 9200
'=== DEFINE POSIÇÃO SENTIDO (APÓS QUEDA OU PULO)
9460 IF US%=1 THEN RETURN 'SUBINDO ESCADA
9461 SE%=1:SD%=1 'ativa direita;esquerda
9463 IF DX%<0 AND (S%<>0 OR S%<>9) THEN S%=9 ELSE S%=0 
9464 GOSUB 9200
9465 RETURN 

'**********************************************************************************************/

'=== GAME OVER
'=== CAIU NO RIO
3090 F%=1:S%=12:GOSUB 9200:LX%=9:LY%=11
3094 GOSUB 3098
3095 LOCATE LX%+2,LY%+1:PRINT " GAME OVER "
3097 GOTO 3097
3098 FOR Z%=0 TO 2:FOR A%=1 TO 13:PUT TILE 181,(LX%+A%,LY%+Z%):NEXT A%:NEXT Z%:RETURN

'=== ABRE O PORTÃO
'3110 P1%=4:P2%=4:P3%=10:GOSUB 20260
 3110 Z%=4
 3112 FOR X0%=0 to 4
 3115    IF TIME-T%<10 THEN 3115 
 3116    T%=TIME
 3120    FOR A%=1 TO Z%
 3125        COPY (CP%,RP%+A%)-(CP%,RP%+A%) TO TL$(A%-1)
 3130        COPY TL$(A%-1) TO (CP%,RP%+A%-1)
 3135    NEXT A%
 3140    IF X0%=0 THEN PUT TILE 0,(CP%,RP%+4) ELSE Z%=Z%-1
 3155 NEXT X0%
 3160 RETURN

'PEGA MOEDA - PONTUA SCORE
3200 SC%=SC%+10:GOSUB 3251
3250 RETURN

3251 LOCATE 22,23: PRINT "SCORE:" ; USING "####"; SC%
3252 RETURN 

'=== SOBE
3300 IF US%=1 THEN 3320 'ATIVADO ESCADA
3305 EE% =TILE(RX%+1,RY%-2):ED%=TILE(RX%  ,RY%-2) 
3310 IF EE%=188 OR EE%=189 OR ED%=189  THEN US%=1 ELSE RETURN 'VERIFICA SE ESTÁ NA PONTA DA ESCADA PRA SUBIR
'POSICIONA NO MEIO 
3311 IF ED% = 189 THEN X%=X%-8 'LADO DIREITO 
3312 IF EE% = 188 THEN X%=X%+8 'LADO ESQUERDO
3320 IF S%=15 THEN S%=18 ELSE S%=15
3321 Y%=Y%-8:TY%=TY%-1:GOSUB 9200 
3322 EE%=TILE(RX%+1,RY%-1) 
3323 IF US%=1 AND (EE%=0 OR EE%=187 OR EE%=139) THEN US%=0 'TERMINOU A ESCADA
3324 IF TY%=5 THEN 10781 'LIMITE SUPERIOR DA TELA
3390 RETURN

'=== LUZ DA TOCHA
3391 IF TIME-VT%<TV% THEN RETURN ELSE VT%=TIME 
3392 IF CL%<>6 THEN CL%=6 ELSE CL%=9
3393 SET TILE COLOR 160,CL%
3394 IF RL%>1 THEN 20130 ELSE TV%=20 
3399 RETURN

'=== DESCE ESCADA
4000 IF US%=1 THEN 4020
4005 EE%=TILE(RX%+1,RY%+1)
4006 ED%=TILE(RX%,RY%+1) 
'POSICIONA NO MEIO
4010 IF EE%=188 OR EE%=189 OR ED%=189 OR ED%=188 THEN US%=1 ELSE RETURN 'VERIFICA SE ESTÁ NA PONTA DA ESCADA PRA SUBIR
4011 IF ED% = 189 THEN  X%=X%-8 'LADO DIREITO 
4012 IF EE% = 188 THEN  X%=X%+8 'LADO ESQUERDO
4020 IF S%=15 THEN S%=18 ELSE S%=15
4030 Y%=Y%+8:TY%=TY%+1:GOSUB 9200
4040 EE%=TILE(RX%+1,RY%) 
'MUDA DE TELA
4041 IF TY%=23 THEN 10770 'LIMITE INFERIOR DA TELA
4050 IF US%=1 AND (EE%=138 OR EE%=128 OR EE%=148 OR EE%=149) THEN US%=0 'TERMINA A ESCADA
4090 RETURN

'DEBUG
5000 'LOCATE 0,0:PRINT STRING$(40," ")
5010 LOCATE 0,23 : PRINT TIME, " - US%",US%
5020 K% = INKEY:IF K%=13 THEN RETURN ELSE GOTO 5020
5060 RETURN 
'5000 RETURN 

'**********************************************************************************************/
' CONFIGURAÇÃO INICIAL
'**********************************************************************************************/

' INICIALIZA TELA
10000 COLOR 15,0,0:SCREEN 2,2,0
10002 SET TILE ON  
10005 CMD WRTSPR  4        ' Load sprite resource
'10007 CMD PLYLOAD 0, 1     ' Load music and sound effect resource
'10008 CMD PLYSONG 0        ' Load game song theme (Bach Invention 14)
'10009 CMD PLYPLAY          ' Play theme
'10023 SET TILE COLOR 164,0
'10024 SET TILE COLOR 156,0
10020 CMD WRTCHR 2       ' Load tiles patterns resource
10021 CMD WRTCLR 3       ' Load tiles colors resource
'10022 CMD WRTSPR 4
10022 TV%=20
10023 CMD SETFNT  1
10024 SET TILE COLOR 169,0
10030 RETURN    

'==== DEFINE VARIÁVEIS INICIAL
10200 T1%=TIME:P%=TL%-5         
10220 SD%=1:SE%=1
10230 Q%=0:ST%=0:VQ%=T1%    'CONTROLE DA QUEDA
10240 JP%=0                 'PULO
10250 F%=0                  'FIM DE JOGO
10252 DIM TL$(4)
10260 RETURN

'==== FUNÇÃO TELA NOVA
10300 CMD DISSCR
' 10301 CMD WRTCHR 2       ' Load tiles patterns resource
' 10302 CMD WRTCLR 3       ' Load tiles colors resource
' 10303 CMD WRTSPR 4
10303 FOR A%=4 TO 6:PUT SPRITE A%,(0,0),15,-1:NEXT A%
10305 CMD WRTSCR TL% 'Carrega tela
10341 GOSUB 3251 'IMPRIME PONTUAÇÃO


10360 'CMD SETFNT  1
10365 'SET TILE COLOR 164,0:SET TILE COLOR 190,0
10366 'SET TILE COLOR 156,0:SET TILE COLOR 169,0
10377 GOSUB 8650'MOEDA
10378 GOSUB 8740'CHAVE
10379 GOSUB 8900'VER PORTÃO ABERTO
10370 CMD ENASCR   
10380 RETURN

'====
10420 GOSUB 10200       'CONFIGURAÇÃO INICIAL
10430 GOSUB 10300       'FUNCAO TELA

' Altera cor das colunasd na tela 5
'10431 IF TL%>=9 THEN FOR I%=208 TO 213 STEP 2:SET TILE COLOR I%,11:NEXT I%

10500 GOSUB 9200        'EXIBE JOGADOR
'LOOP
10510 GOSUB 9100        'GET USER INPUT
10520 GOSUB 9300        'MOVIMENTOS HEROI
10530 GOSUB 9600        'PULO
10540 GOSUB 9500        'QUEDA LIVRE
10531 GOSUB 3391        'LUZ DA TOCHA

'10511 GOSUB 20200 'PLATAFORMA

10550 GOSUB 10561       'ZERA O TIMER

'DESVIA DOS EVENTOS TELA AZUL
10532 TA%=TL%-4:LOCATE 0,3:PRINT TA%
10539 IF (TA%>11  AND TA%<=20) THEN 10510 'TELA CINZA

10551 IF TA%<3 OR TA%=4 OR TA%=8 OR TA%=9  THEN GOSUB 8200 'ALIEN
10553 IF TA%=2 THEN GOSUB 10720             'BAT
10554 IF TA%=1 THEN GOSUB 10800             'BAT 2
10556 IF TA%=2 OR TA%=4 THEN GOSUB 7000     'GOTEIRA
10557 IF TA%=1 THEN GOSUB 10630             'RIVER
10559 IF TA%=4 AND FE%=1   THEN GOSUB 8500  'ESPETOS
10560 GOTO 10510

'==== ZERA O TIME
10561 IF TIME<0 THEN TIME=0:VQ%=0:T1%=0:T%=0:VT%=0:T7%=0:DT4%=0:T4%=0:T5%=0:T11%=0:T13%=0:T14%=0:T15%=0:T10%=0:T16%=0
10562 RETURN

'==== TELA 1
'X%=8:Y%=79:TY%=12
10570 TL%=5                                 'POSICAO INICIAL DO JOGADOR
10571 RP%=16:CP%=31                         'ABRE PORTÃO FASE 1
'10572 US%=0                                'UPSTAIR SOBE ESCADA ATIVADO
'10573 VT%=T1%:CL%=9                        'LUZ DA TOCHA
10574 S7%=134:T7%=T1%: Y7%=21: X7%=13       'RIVER
10575 GOSUB 20039                           'BAT 1
10576 GOSUB 20020                           'BAT 2
10578 _X%=80:_Y%=151:_F%=0:_C%=14:_S%=33:_D%=-3:GOSUB 20000 'ALIEN
'10579 T16%=T1% 'time pulo
10582 GOTO 10420

'==== TELA 2
'X%=232:
10600 TL%=6 : IF A%=1 THEN X%=232 ELSE X%=8
10601 RP%=7:CP%=0     'ABRE PORTÃO FASE 2 
10602 _X%=7:_Y%=6:_T%=30:GOSUB 20010  'GOTEIRA
10603 _X%=32:_Y%=151:_F%=0:_C%=5:_S%=33:_D%=3:GOSUB 20000 'ALIEN
'10604 GOSUB  20020 'BAT
10609 GOSUB  20030 'BAT
10604 RETURN 

'==== TELA 3
10605 TL%=7 
10608 RETURN 

'==== TELA 4
11100 TL%=8 'PUT SPRITE 6,(X10%,Y10%),CL10%,0
11101 CP%=6:RP%=9 
11102 _X%=200:_Y%=151:_F%=1:_C%=14:_S%=35:_D%=-3:GOSUB 20000 ' ALIEN
11103 _X%=17:_Y%=14:_T%=15:GOSUB 20010  'GOTEIRA
11104 XES%=15:YES%=11       'LANÇA
11105 RETURN 

'==== TELA 6
11110 TL%=10 : DI%=1:DX%=8
'*ALIEN
11111 _X%=140:_Y%=151:_F%=0:_C%=13:_S%=33:_D%=-3:GOSUB 20000 'ALIEN
'*BAT 2 LM5%=LIMITE DA DESCIDA LS5% LIMITE SUBIDA
11112 S5%=29:LM5%=115:LS5%=90:X5%=210:Y5%=LS5%:T5%=T1%:D5%=2:DY%=-1  
11115 RETURN 

'==== TELA 7
11200 TL%=11:X%=8:X10%=152:Y%=151:TY%=21:S%=0:CL10%=14:RP%=18:CP%=27:RETURN 

'==== TELA 8
10400 TL%=12:X10%=152:CL10%=11
10401 HP%=1:_X%=200:_Y%=151:_F%=0:_C%=12:_S%=33:_D%=-3:GOSUB 20000 ' ALIEN
10409 RETURN

'==== TELA 9
10410 TL%=13:CL10%=14:X10%=120:CP%=11:RP%=8 
10411 HP%=1:_X%=120:_Y%=151:_F%=0:_C%=14:_S%=33:_D%=-3:GOSUB 20000 ' ALIEN
10412 RETURN 

'FASE CINZA
'==== TELA 10 (SÓ VEM DO PORTAL POR ENQUANTO)
10900 TL%=14  : DI%=1:DX%=8
10901 ON INTERVAL = 4*60 GOSUB 20040
10902 INTERVAL ON
10909 RETURN 

'==== TELA 11 (VEM DIREITA 13>11 / ESQUERDA 11<12)
10910 TL%=15 
10919 RETURN 

'==== TELA 12
10920 TL%=16
10929 RETURN 

'==== TELA 13
10930 TL%=17:CP%=13:RP%=12-4 
10939 RETURN 

'==== TELA 14
10940 TL%=18:RP%=6:CP%=31:DI%=1:DX%=8
10949 RETURN

'==== TELA 15
10950 TL%=19
10959 RETURN

'==== TELA 16
10960 TL%=20
10969 RETURN

'==== TELA 16
10970 TL%=21
10979 RETURN
'************************************


'===> RIVER
10630 IF TIME-T7%<60 THEN RETURN 
10631 T7%=TIME
10650 IF S7%=151 THEN S7%=134 ELSE S7%=151
10660 FOR A%=0 TO 4
10670   PUT TILE S7%,(X7%+A%,Y7%)
10680 NEXT A
10690 RETURN

'DIRECIONA mudança entre telas aqui

'******************************************************************************************
'=== ESQUERDA
10700 A%=TL%-4:X%=232:HP%=0
'10701 LOCATE 0,1:PRINT "ESQ - TELA",A% :K% = INKEY:IF K%=13 THEN 10703 ELSE  10701
 '                 1>2  2>3   3  4>1   5 6 7  8>6   9>8    11>13  12>11      16>15
10703 ON A% GOSUB 10600,10605, 0 ,10570,0,0,0,11110,10400,0,10930,10910,0,0,10940,10950 
10704 GOTO 10420
'******************************************************************************************
'******************************************************************************************
'=== DIREITA
 10712 A%=TL%-4:X%=8:HP%=0
 '10713 LOCATE 5,3:PRINT "TELA",A% :K% = INKEY:IF K%=13 THEN 10714 ELSE  10713
'                  1>4   2>1   3>2    4>6    5 6>8   7  8>9  9 0  11>12     13>11  14>15  15>16                   
 10714 ON A% GOSUB 11100,10570,10600, 11110 ,0,10400,0,10410,0,0,10920, 0 , 10910, 0, 10960
 10715 GOTO 10420
 '******************************************************************************************
'******************************************************************************************
'=== DESCE ESCADA
 10770 A%=TL%-4:TY%=5:Y%=((TY%*8)-16)-1
 10771 IF A%=10 THEN GOSUB 10910
 10772 IF A%=14 THEN GOSUB 10950
 10773 GOTO 10420
'******************************************************************************************
'=== SOBE ESCADA
10781 A%=TL%-4:TY%=22:Y%=((TY%*8)-16)-1
10782 IF A%=16 THEN GOSUB 10970
10784 GOTO 10420


'===> BAT
10720 IF TIME-T4%<6 THEN RETURN
10730 T4%=TIME
10740 IF S4%>=28 AND S4%<32 THEN S4%=S4%+1 ELSE S4%=29 
10750 IF X4%>=230 OR X4%<=200  THEN D4%=D4%*-1
'10770 X4%=X4%+D4%
10751 PX%=X%-X4%:PY%=Y%-Y4%
10752 IF (ABS(PX%)>ABS(PY%)) THEN X4%=X4%+1*SGN(PX%) ELSE Y4%=Y4%+1*SGN(PY%)
10780 PUT SPRITE 4,(X4%,Y4%),12,S4%
10790 RETURN

'===> BAT 2
10800 IF TIME-T5%<4 THEN RETURN
10810 T5%=TIME
10811 IF WB%=3 THEN WB%=0:GOSUB 10891
'10820 IF S5%>=28 AND S5%<32 THEN S5%=S5%+1 ELSE S5%=29 
10830 IF X5%>=220 OR X5%<=50	THEN D5%=D5%*-1
10850 IF Y5%=LS5% OR Y5%=LM5%	THEN DY%=DY%*-1 
10870 Y5%=Y5%+DY%:X5%=X5%+D5%
10880 PUT SPRITE 5,(X5%,Y5%),5,S5%
10881 WB%=WB%+1
10890 RETURN

10891 IF S5%>=28 AND S5%<32 THEN S5%=S5%+1 ELSE S5%=29 
10892 RETURN



'ABRE BAÚ
 11080 GOSUB 11086 'ZERA A CHAVE ATIVA
 11081 FOR A%=1 TO 2:PUT TILE   0,(RX%+3,RY%-A%):PUT TILE   0,(RX%+4,RY%-A%):NEXT A%
 11082 PUT TILE 222,(RX%+2,RY%-3):PUT TILE 223,(RX%+3,RY%-3)
 11085 RETURN

'UTILIZA A CHAVE
11086 FM%=0:PUT TILE 0,(30,2):RETURN

'11040 '===> COLISÃO DE SPRITES
'11045 DT8%=TIME-T8%:IF DT8%<5 THEN RETURN
'11050 T8%=TIME
'11055 IF COLLISION(0, 5)>0 THEN GOSUB 10100:RETURN              'BAT 2
'11060 IF COLLISION(0, 3)>0 THEN GOSUB 10100:GOSUB 10200: RETURN 'FOGO 
'11065 GOSUB 10020 'VERIFICA COLISÃO DE TILE
'11070 RETURN

'******************************************************************************
'==== GOTEIRA
'******************************************************************************
7000 IF TIME-T13%<LT% THEN RETURN 
7001 T13%=TIME
7002 ON F1% GOTO 7020,7030,0,7040,7045,7046,7047:GOTO 7010
'=== DESVIOS
7010 F1%=1:TG%=193:GOTO 8000 
7020 F1%=2:TG%=194:GOTO 8000 
7030 F1%=4:TG%=195:GOTO 8000 
7040 LT%=10:F1%=5:Y13%=Y13%+1:GOTO 8000 
7045 Y13%=Y13%+1:GOTO 8000              'CAINDO
7046 TG%=196:GOSUB 8000:F1%=7:RETURN    'COLIDIU
7047 TG%=0  :GOSUB 8000:F1%=0:Y13%=MY13%:LT%=30:RETURN
'=== EXIBE GOTEIRA
8000 PUT TILE TG%,(X13%,Y13%)':LOCATE 0,0:PRINT F1%,TG%
8012 IF F1%=5 THEN  PUT TILE 0,(X13%,Y13%-1):GOSUB 8100 'APAGA RASTRO QDO ESTÁ CAINDO
8013 IF TILE(X13%,Y13%+1)<>0 THEN F1%=6      'COLISÃO COM O CHÃO
8090 RETURN
'=== COLISAO
8100 CT%=TILE(X%/8,TY%-3):CK%=TILE(X%/8+1,TY%-3)
8110 IF CT%=195 OR CK%=195 THEN F1%=6:GOTO 7046 'GOSUB 10100 'reduz coração
8120 RETURN
'******************************************************************************

'******************************************************************************
'=== ALIEN
'******************************************************************************
8200 IF TIME-T10%<12 THEN RETURN  
8211 T10%=TIME
8212 'LOCATE 0,2:PRINT "HP",HP%,"D10%",D10%,"S10%",S10%
8213 IF WK%=2 THEN CH%=1:WK%=0:GOSUB 8301 ELSE CH%=0
8231 IF HP%=1 THEN GOSUB 8303
8240 MD10%=D10%
8250 IF TILE (X10%/8+1,Y10%/8+2)=167 THEN D10%=D10% *-1
8270 X10%=X10%+D10%
8280 IF MD10%<>D10% AND FLP%=1 THEN SET SPRITE FLIP 35,0:SET SPRITE FLIP 36,0:MD10%=D10%
8290 PUT SPRITE 6,(X10%,Y10%),CL10%,S10%
8291 WK%=WK%+1
8300 RETURN
'TROCA SPRITE
8301 IF S10%=MS10%+1 THEN S10%=MS10% ELSE S10%=MS10%+1
8302 RETURN

'SEGUE O HERÓI
8303 IF X10%>X% THEN D10%=-3 ELSE D10%=3
8306 RETURN

'=== ESPETOS
8500 IF TIME-T14%<15 THEN RETURN 
8501 T14%=TIME 
8502 IF EP%=200 THEN  EP%=199 ELSE EP%=200
8503 PUT TILE EP%,(XES%,YES%)
8505 RETURN

'=== VERIFICA SE A MOEDA JÁ FOI PEGA

 8620 'GUARDA POSIÇÃO DA MOEDA
 8625 MXY%(P%,0) = PX% 
 8626 MXY%(P%,1) = PY% 
 8627 MXY%(P%,2) = TILE(PX%-1,PY%)
 8628 GOSUB 8660 'LIMPA MOEDA
 8631 GOSUB 3200 'PONTUA
 8635 RETURN

  8650 'LIMPA A MOEDA
  8655 IF MXY%(P%,0)=0 THEN RETURN
  8660 TT% =MXY%(P%,2)
  '8661 'IF TT%<>187 THEN TT%=0
  8662 PUT TILE TT%,(MXY%(P%,0),MXY%(P%,1))
  8670 RETURN

 8700 'GUARDA POSIÇÃO CHAVE
 8705 ON FM% GOTO 8730
 8706 FM%=1
 8710 OBP%(P%,0)=PX%  'TELA, OBJ, X
 8715 OBP%(P%,1)=PY%  'TELA, OBJ, Y
 8716 OBP%(P%,2)=TILE(PX%-1,PY%)
 8720 GOSUB 8750 'LIMPA CHAVE
 8730 RETURN

 ' EXIBE/ESCONDE  A CHAVE
 8740 ON FM% GOTO 8750
 8742 IF OBP%(P%,0)=0 THEN RETURN
 8750 TT% = OBP%(P%,2)
 8752 PUT TILE TT%,(OBP%(P%,0),OBP%(P%,1))
 8753 IF FM%=1 THEN PUT TILE 172,(30,2)
 8760 RETURN


'=== ALAVANCA ESQUERDA/DIREITA
8800 IF DI%<0 THEN CA%=203 ELSE CA%=219 
8810 PUT TILE   0,(PX%,PY%):PUT TILE CA%,(PX%,PY%+1)
8811 POR%(P%,0)=PX%:POR%(P%,1)=PY%
8812 POR%(P%,2)=CA%
8813 GOTO 3110 'ABRE O PORTÃO
'8814 RETURN


'=== VERIFICA SE PORTÃO ESTÁ ABERTO
'=== DESABILITA PORTÃO
8900 P%=TL%-5
8901 'locate 0,3:print "P",P%,"POR%",POR%(P%,0):GOSUB 5000
8902 IF POR%(P%,0)=0 THEN RETURN
8904 FOR A%=0 TO 4
8905    PUT TILE 0,(CP%,RP%+A%)   'PUT TILE 190,(RP%,CP%+A%)
8910 NEXT A%
8911 'LOCATE 0,0: PRINT "PASSEI",POR%(P%,0),POR%(P%,1)
8912 CA% = POR%(P%,2)
8913 PUT TILE   0,(POR%(P%,0) , POR%(P%,1))
8914 PUT TILE CA%,(POR%(P%,0) , POR%(P%,1)+1)
8915 RETURN
 
'=== ABRE O PORTÃO

 9000 Z%=2
 9010 FOR X0%=0 to 3
 9020    IF TIME-T%<20 THEN 9020 
 9030    T%=TIME
 9040    FOR A%=1 TO Z%
 9050        COPY (CP%,RP%+A%)-(CP%+1,RP%+A%) TO TL$(A%-1)
 9060        COPY TL$(A%-1) TO (CP%,RP%+A%-1)
 9070    NEXT A%
 9080    IF X0%=0 THEN FOR C%=0 TO 1:PUT TILE 169,(CP%+C%,RP%+2):NEXT C% ELSE Z%=Z%-1
 9090 NEXT X0%

9091 GOSUB 11086 'ZERA CHAVE
9092 LOCATE 10,2:PRINT 'PORTAL ABERTO"
9093 RETURN


'ENTRA NO PORTAL
9880 '
9881 FOR W%=1 TO 6
9882    IF S%=15 THEN S%=18 ELSE S%=15
9883    GOSUB 9200 
9884    IF TIME-T%<20 THEN 9884 
9885    T%=TIME  ':IF W% MOD 3 = 1 AND TA%=4 THEN  GOSUB 20040
9386 NEXT W%
9387 'K% = INKEY:IF K%=13 THEN 9388 ELSE 9387
9388 IF TL%=8  THEN X%=24: Y%=151:TY%=21:S%=0            : GOSUB 11110 
9389 IF TL%=11 THEN X%=8 : Y%=79:TY%=12:S%=0             : GOSUB 10570
9390 IF TL%=13 THEN X%=24: TY%=11:Y%=((TY%*8)-16)-1:S%=0 : GOSUB 10900 '9=>10
9391 IF TL%=17 THEN X%=24: TY%=16:Y%=((TY%*8)-16)-1:S%=0 : GOSUB 10940 '13=>14


9399 GOTO 10420


'PARAMETROS

' X10%  = _X 'X
' Y10%  = _Y 'Y
' FLP%  = _F 'FLIP 
' CL10% = _C 'COR
' MS10% = _S 'SPRITE
' D10%  = _D 'DIREÇÃO

'ALIEN
20000 X10%  = _X% 'X
20001 Y10%  = _Y% 'Y
20002 FLP%  = _F% 'FLIP 
20003 CL10% = _C% 'COR
20004 MS10% = _S% 'SPRITE
20005 D10%  = _D% 'DIREÇÃO

20006 S10%=MS10%
20007 T10%=T1%
20008 MD10%=D10%     
20009 RETURN
'***************************************************

'GOTEIRA
20010 '
20011 X13%  = _X% 'X
20012 Y13%  = _Y% 'Y
20013 LT%   = _T% 'TIME
20014 T13%  = T1%
20015 MY13% = Y13% 'Y
20016 F1%   = 0
20017 RETURN


'BAT
' BAT 2 LM5%=LIMITE DA DESCIDA LS5% LIMITE SUBIDA

20020 S5%=29:LM5%=130:LS5%=110:X5%=210:Y5%=LS5%:T5%=T1%:D5%=2:DY%=-1  
20029 RETURN 

'BAT 1
20030 S4%=29:X4%=210:Y4%=50:T4%=T1%:D4%=1   'BAT
20039 RETURN

'  20040 ' IF TA%<>10 THEN RETURN
'  20041 CL%=15
'  20042 ZT%=TIME
'  20050 FOR V%=1 TO 2
'  20060   FOR Z%=214 TO 217
'  20070       SET TILE COLOR Z%,CL%
'  20080   NEXT Z%
'  20090   IF TIME-ZT%<3 THEN 20090 ELSE 20100
'  20100   ZT%=TIME
'  20101   IF CL%=4 THEN CL%=15 ELSE CL%=4
'  20110 NEXT V%
'  20111 INTERVAL OFF
'  20120 RETURN

20040 RL%=5:INTERVAL OFF:TV%=15:RETURN

20130 IF CD%=15 THEN CD%=4 ELSE CD%=15
20135 FOR Z%=214 TO 217:SET TILE COLOR Z%,CD%:NEXT-
20136 IF RL%>0 THEN RL%=RL%-1
20138 RETURN


20200 'PLATAFORMA
20210 IF TIME-T11%<13 THEN RETURN  
20215 T11%=TIME
20217 IF X11% >25 THEN JX%=-1
20218 IF X11% <2  THEN JX%=1 
'20219 LOCATE X11%,Y11%:PRINT "  "
20220 _S=0:GOSUB 20250
20221 X11%=X11%+JX%
'20221 LOCATE X11%,Y11%:PRINT CHR$(152) + CHR$(152) 
20223 _S=152:GOSUB 20250
20224 _K=(Y%/8)+3 : HJ%=TILE(X%/8+JX%,(Y%/8)+3):HW%=TILE(X%/8+(JX%*2),(Y%/8)+3)
20225 IF HJ%=152 OR HW%=152   THEN  X%=X%+(8*JX%):GOSUB 9200
20226 LOCATE 11,1:PRINT TX%,X11%,HJ%
20233 RETURN

'SUB ROTINA - PLATAFORMA
20250 FOR A%=0 TO 1
20251   PUT TILE _S,(X11%+A%,Y11%)
20252 NEXT A%
20253 RETURN

'
