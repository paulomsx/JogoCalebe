FILE "gd1.akm"            ' 0 - Music (exported from Arkos Tracker 2)
FILE "gd1.akx"            ' 1 - Sound Effects (expord from Arkos Tracker 2)

FILE "TILES.chr.plet5"  ' 2 - Tiles Patterns (exported from nMSXTiles)
FILE "TILES.clr.plet5"  ' 3 - Tiles Colors (exported from nMSXTiles)

FILE "S8.SPR"           ' 4 - Sprites (exported from TinySprite)

FILE "TELA1.plet5"      ' 5 - Tela 1 
FILE "TELA2.plet5"      ' 6 - Tela 2 
FILE "TELA3.plet5"      ' 7 - Tela 3
FILE "TELA4.plet5"      ' 8 - Tela 4
FILE "TELA5.plet5"      ' 9 - Tela 5
FILE "TELA6.plet5"      '10 - Tela 6
FILE "TELA7.plet5"      '11 - Tela 7
FILE "TELA8.plet5"      '12 - Tela 8
FILE "TELA9.plet5"      '13 - Tela 9

0 '
11 X%=8:Y%=79:TY%=12:S%=0  'POISICAO INICIAL DO JOGADOR
12 DX%=8:S%=0         'POSIÇÃO INICIAL CANTO ESQUERDA - VIRADO PARA DIREITA
13 RP%=16:CP%=31      'ABRE PORTÃO
14 SC%=0              'SCORE Score
15 DIM MXY%(10,1) 'MOEDA
16 DIM OBP%(10,1) 'CHAVE
17 DIM POR%(10,2) 'PORTÃO

10 GOSUB 10000       'INICIALIZA GAME
20 GOSUB 10200       'DEFINE VARIÁVEIS INICIAIS
'30 X%=8:GOTO  10570       'INICIALIZA JOGO TELA 1
'30 X%=24:Y%=151:TY%=21:S%=0:GOTO  11110       'INICIALIZA JOGO TELA 6
30 GOTO  11200       'INICIALIZA JOGO TELA 7


'===>GET USER INPUT
9100 K% = INKEY
9101 J% = STICK(0) OR STICK(1)
9102 B% = STRIG(0) OR STRIG(1)
9105 RETURN
 
'===>EXIBE JOGADOR
'9200 IF JP%>0 THEN IF DI%=-1 THEN S%=6 ELSE S%=3 '**** DEFINE O SPRITE NO PULO
9200 IF JP%>0 THEN IF DI%=-1 THEN S%=24 ELSE S%=21 '**** DEFINE O SPRITE NO PULO
9201 PUT SPRITE  0,(X%,Y%), 4,S%   'COR AZUL
9202 PUT SPRITE  1,(X%,Y%), 9,S%+1 'COR BRANCA
9203 PUT SPRITE  2,(X%,Y%),15,S%+2 'COR PELE

9204 LOCATE 0,0:PRINT "                                                   " : LOCATE 0,0:PRINT "X",X%,"Y",Y%,"TY",TY%,"TX",X%/8," - TL",TL%
'9204 LOCATE 0,0:PRINT "                                                   " : LOCATE 0,0:PRINT "RX",RX%,"X",X%
9205 IF F%=1 THEN RETURN
9206 GOSUB 9220  'VER PISO 
9207 GOSUB 9400  'ATUALIZA POSIÇÃO DO TILE DO JOGADOR
9208 GOSUB 11040 'VER COLISÃO MOEDA
9209 GOSUB 11000 'VER COLISÃO TILE CARANGUEJO
9210 RETURN

'===>PEGA O TILE DO JOGADOR
9220 'PUT TILE 0,(RX%,RY%-2):PUT TILE 0,(RX%+1,RY%-2) 'PARA RASTREAR
9221 RX%  = X%/8:RY%=TY%
9222 CF%  = TILE(RX%,RY%)   'TILE PISO  
9223 CF2% = TILE(RX%+1,RY%) 'TILE PISO    
'9224 PUT TILE CF%,(RX%,RY%-3) 'PARA RASTREAR
'9225 PUT TILE CF2%,(RX%+1,RY%-3) 'PARA RASTREAR
9226 RETURN

'**********************************************************************************************/
' ** MOVIMENTO DO JOGADOR
'**********************************************************************************************/
9300 IF ST%=1                       THEN RETURN 'SE TIVER EM QUEDA NÃO MOVIMENTA AS SETAS
9320 DT%=TIME-T1%:IF DT%<7          THEN RETURN ELSE T1%=TIME 'TIME
'SOBE
9321 IF J%=1                        THEN GOSUB 3300:RETURN 'GOSUB 9374:GOSUB 9200:RETURN 'CIMA
'DESCE
9322 IF J%=5                       THEN GOSUB 4000:RETURN 'GOSUB 9374:GOSUB 9200:RETURN 'CIMA
'PULO
9323 IF JP%=0   AND US%<>1          THEN IF B%<>0 THEN JP%=6:SE%=1:SD%=1:RETURN           'PULO
' COLOQUEI SD% E SE% = 1 PARA QDO O PERSONAGEM PULAR QDO ESTIVER DO LADO DO BLOCO E NÃO ENTRAR NA CAIXA
9325 IF J%=3 AND SD%=1  AND US%<>1 THEN SE%=1:GOSUB 9360:RETURN 'DIREITA
9326 IF J%=7 AND SE%=1  AND US%<>1 THEN SD%=1:GOSUB 9350:RETURN 'ESQUERDA
9327 IF J%=0 AND S%<>0 AND S%<>9   THEN GOSUB 9460:RETURN  'DEFINE POSIÇÃO SENTIDO
9340 RETURN
'**********************************************************************************************/

'**********************************************************************************************/
'MOVE ESQUERDA
'**********************************************************************************************/
9350 GOSUB 9700 'VERIFICA SE HÁ PAREDE DO LADO ESQUERDO
9352 IF SE%=0 THEN SE%=1:RETURN
9353 DI%=-1:DX% =-8:X%=X%+DX%:IF S%=6 THEN S%=9 ELSE S%=6 
9355 GOSUB 9200 'EXIBE JOGADOR
9358 RETURN 

'=== VERIFICA SE HÁ PAREDE OU PORTÃO DO LADO ESQUERDO -  BLOCO VERMELHO
'9700 IF RX%-1<0 THEN 9375  'SAI À ESQUERDA
9700 GOSUB  9375  'SAI À ESQUERDA
9701 XT%=TILE(RX%-1,RY%-1) 'PÉ
9702 XU%=TILE(RX%-1,RY%-2) 'VER MOEDA - NARIZ


'9703 IF XT%=148 OR XT%=168 OR XT%=170 OR XT%=157 OR XT%=204  THEN SE%=0:RETURN   'BLOCO VERMELHO (PAREDE) 157-PORTAL VERDE

9703 IF XT%=148 OR XT%=168 OR XT%=170 OR XT%=157 THEN SE%=0:RETURN   'BLOCO VERMELHO (PAREDE) 157-PORTAL VERDE

9704 PX%=RX%-1:PY%=RY%-2
9711 IF XU%=172 THEN 9679 'PEGA CHAVE
9712 IF XU%=147 THEN 8620 'PEGA MOEDA
9714 IF XU%=201 THEN SE%=0:GOTO 8800 'ALAVANCA
9715 IF XT%=156 THEN FE%=1 'ATIVA ESPETO

9716 IF XU%=180 AND FM%=1  THEN 9000 'ABRE O PORTÃO
9719 RETURN 

'=== VER SE TEM SAÍDA A ESQUERDA
9375 XT%=TILE(RX%,RY%-2) ':LOCATE 0,1:PRINT XT%
9379 IF XT%=164 THEN  10700 ' saída parede
9380 RETURN
'**********************************************************************************************/

'**********************************************************************************************/
'DIREITA
'**********************************************************************************************/
'9360 IF RX%>=30 THEN GOSUB 9720 'VERIFICA A DIREITA
9360 GOSUB 9720 'VERIFICA A DIREITA
9363 IF SD%=0 THEN SD%=1:RETURN
9366 DI%=1:DX%=8:X%=X%+DX%:IF S%=3 THEN S%=0 ELSE S%=3 
9367 GOSUB 9200 'EXIBE JOGADOR
9377 RETURN


 
'=== VERIFICA SE HÁ PAREDE OU PORTÃO DO LADO DIREITO -  BLOCO VERMELHO
'9720 IF RX%>30 THEN 9730     'SAI A DIREITA
9720 GOSUB 9730     'SAI A DIREITA
9721 XT%=TILE(RX%+2,RY%-1)   'PÉ
9723 XU%=TILE(RX%+2,RY%-2)  

9724 IF XT%=170 OR XT%=166 OR XT%=148 THEN SD%=0:RETURN 'BLOCO VERMELHO (PAREDE)
9725 PX%=RX%+2:PY%=RY%-2

9381 IF XU%=172 THEN 9679 'PEGA CHAVE
9382 IF XU%=180 AND FM%=1  THEN 9000 'ABRE O PORTÃO
9726 IF XU%=147 THEN 8620 'PEGA MOEDA
9727 IF XU%=221 THEN SD%=0:GOTO 8800 'ALAVANCA
9728 IF TILE(RX%+3,RY%-1)=130 AND FM%=1 THEN 11080 'ABRE BAÚ
9729 RETURN 

'=== VER SE TEM SAÍDA A DIREITA
9730 XT%=TILE(RX%,RY%-1) 
9731 XU%=TILE(RX%+1,RY%-1) 
9740 IF XU%=164 OR (XT%=164 AND DX%>0) THEN 10712 
9750 RETURN
'**********************************************************************************************/

'**********************************************************************************************/
' CONTROLE DA QUEDA
'**********************************************************************************************/
9400 IF US%=1 THEN RETURN  ' SUBINDO ESCADA
9401 IF CF%<>148 AND CF2%<>148 AND CF%<>174 AND CF2%<>174 AND CF%<>173 AND CF2%<>173 AND CF%<>128 AND CF2%<>128 AND CF%<>129 AND CF2%<>129  AND JP%=0 THEN GOSUB 9420 ELSE GOSUB 9440  '=== VERIFICA PISO
9403 IF CF%=135 OR CF2%=135 OR CF%=186 OR CF2%=186 THEN GOTO 3090 ' CAIU NO RIO
9410 RETURN

'=== QUEDA LIGADA
9420 Q%=8:ST%=1
9430 RETURN

'=== QUEDA DESLIGADA
9440 IF ST%=0 THEN RETURN
9441 Q%=0:ST%=0 
'=== NO FINAL DA QUEDA IDENTIFICA OS CARACTERES A DIREITA E A ESQUEDA
'9442 DR%=TILE(RX%+2,RY%-2):IF DR%=152  THEN SD%=0 ELSE SD%=1
'9444 ES%=TILE(RX%-1,RY%-2):IF ES%=152  THEN SE%=0 ELSE SE%=1
9450 RETURN

'=== QUEDA LIVRE
9500 IF TIME-VQ%<4 OR Q%=0 THEN RETURN  ' CONTROLA VELOCIDADE DA QUEDA
9502 VQ%=TIME
9508 IF J%=1 THEN Q%=0:ST%=0:RETURN '****SETA PRA CIMA
9510 GOSUB 9400 'CONTROLE DA QUEDA
9520 IF Q%=0 THEN RETURN
9522 GOSUB 9460 'CAI EM PÉ
9530 Y%=Y%+Q%:TY%=TY%+ST%
9590 RETURN
'**********************************************************************************************/

'**********************************************************************************************/
'PULO
'**********************************************************************************************/
9600 'IF JP%=0 THEN RETURN
9601 IF TIME-T16%<5 OR JP%=0 THEN RETURN 
9602 T16%=TIME
9603 ' IF JP%=6  THEN GOSUB 9470 'VER SE TILE ACIMA É TETO
'9604 IF XT%=168 OR XV%=168  THEN J%=0:JP%=0:RETURN 'SE FOR CANCELA O PULO

'168=TETO
'9604 GOSUB 9470:IF XT%=168 or XT%=128 OR XV%=168 OR XV%=128  THEN JP%=0:J%=0:Q%=8:ST%=1:return
'9604 GOSUB 9470:IF XT%=168 or XT%=128   THEN JP%=0:J%=0:Q%=8:ST%=1:return

9604 GOSUB 9470:IF XT%=168  THEN JP%=0:J%=0:Q%=8:ST%=1:return


9620 JP%=JP%-1                           
9630 IF JP% > 3 THEN GOSUB 9671  
9631 IF JP% < 1 THEN Y%=Y%+8:TY%=TY%+1
9641 GOSUB 9200
9670 RETURN

'=== VERIFICA O TILE DE CIMA E DECIDE SE CANCELA O PULO
 9470 XT%=TILE(RX%,TY%-3)
 '9471 XV%=TILE(RX%+1,TY%-3) 
' 9472 LOCATE 15,2:PRINT "          ":LOCATE 15,2:PRINT XT%,XV%
 9473 RETURN

'=== PULO CIMA
9671 'GOSUB 9470 'VER TETO
'9672 IF XT%=168 OR XT%=128  THEN JP%=0:J%=0:Q%=8:ST%=1:goto 9400  ' 168=TETO
'9672 IF XT%=168 OR XT%=128 OR XV%=168 OR XV%=128  THEN JP%=0:J%=0:Q%=8:ST%=1:goto 9400  ' 168=TETO
'9673 IF XT%=172 OR XV%=172 THEN GOSUB 8700 ' GOSUB 3170     ' 172 - CHAVE
'CHAVE - 172 
9373 IF XT%=172 AND FM%=0 THEN PX%=RX%  :PY%=TY%-3:GOTO 9679    
9374 IF XV%=172 AND FM%=0 THEN PX%=RX%+1:PY%=TY%-3:GOTO 9679             
9376 Y%=Y%-8:TY%=TY%-1
9678 RETURN

'PEGA CHAVE
9679 GOSUB 8700:RETURN

'PEGA CHAVE
'9680 IF XT%=172 OR XV%=172 THEN GOTO 3170 ' 172 - CHAVE
'9689 RETURN

'=== DESCE APÓS O PULO
'9383 Y%=Y%+8:TY%=TY%+1:RETURN

'=== DEFINE POSIÇÃO SENTIDO (APÓS QUEDA OU PULO)
9460 IF US%=1 THEN RETURN 'SUBINDO ESCADA
9463 IF DX%<0 THEN S%=9 ELSE S%=0 
9464 GOSUB 9200
9465 RETURN 

'**********************************************************************************************/

'=== GAME OVER
'=== CAIU NO RIO
3090 F%=1:S%=12:GOSUB 9200:LX%=9:LY%=11
3094 GOSUB 3098
3095 LOCATE LX%+2,LY%+1:PRINT " GAME OVER "
3097 GOTO 3097
3098 FOR Z%=0 TO 2:FOR A%=1 TO 13:PUT TILE 181,(LX%+A%,LY%+Z%):NEXT A%:NEXT Z%:RETURN

'=== ABRE O PORTÃO
3110 Z%=4
3112 FOR X0%=0 to 4
3115    IF TIME-T%<10 THEN 3115 
3116    T%=TIME
3120    FOR A%=1 TO Z%
3125        COPY (CP%,RP%+A%)-(CP%,RP%+A%) TO TL$(A%-1)
3130        COPY TL$(A%-1) TO (CP%,RP%+A%-1)
3135    NEXT A%
3140    IF X0%=0 THEN PUT TILE 164,(CP%,RP%+4) ELSE Z%=Z%-1
3155 NEXT X0%
3160 RETURN

'PEGA MOEDA - PONTUA SCORE
3200 SC%=SC%+10:GOSUB 3251
3250 RETURN

3251 LOCATE 22,23: PRINT "SCORE:" ; USING "####"; SC%
3252 RETURN 

'=== SOBE
3300 IF US%=1 THEN 3320 'ATIVADO ESCADA

3305 XU% =TILE(RX%+1,RY%-2) 
3306 XU2%=TILE(RX%  ,RY%-2) 

3307 IF XU%=169 AND XU2%=XU% THEN GOSUB 9880 


3310 IF XU%=188 OR XU%=189 OR XU2%=189  THEN US%=1 ELSE RETURN 'VERIFICA SE ESTÁ NA PONTA DA ESCADA PRA SUBIR

'POSICIONA NO MEIO 
3311 IF XU2%  = 189 THEN X%=X%-8 'LADO DIREITO 
3312 IF XU%   = 188 THEN X%=X%+8 'LADO ESQUERDO

'DE FRENTE PARA O PORTAL
'3313 IF XU%=169 OR XU2%=169 THEN LOCATE 0,2:PRINT "PORTAL":K% = INKEY:IF K%=13 THEN 3312

3320 IF S%=15 THEN S%=18 ELSE S%=15
3321 Y%=Y%-8:TY%=TY%-1:GOSUB 9200 
3322 XU%=TILE(RX%+1,RY%-1) ':PUT TILE XU%,(2,4)
3323 IF US%=1 AND XU%=0 THEN US%=0
3390 RETURN

'=== LUZ DA TOCHA
3391 IF TIME-VT%<20 THEN RETURN ELSE VT%=TIME 
3392 IF CL%<>6 THEN CL%=6 ELSE CL%=9
3393 SET TILE COLOR 160,CL%
3395 RETURN

'=== DESCE ESCADA
4000 IF US%=1 THEN 4020

4005 XU%=TILE(RX%+1,RY%)
4006 XU2%=TILE(RX%,RY%) 

'POSICIONA NO MEIO
4010 IF XU%=173 OR XU%=174 OR XU2%=174  THEN US%=1 ELSE RETURN 'VERIFICA SE ESTÁ NA PONTA DA ESCADA PRA SUBIR
4011 IF XU2% = 174 THEN  X%=X%-8 'LADO DIREITO 
4012 IF XU%  = 173 THEN  X%=X%+8 'LADO ESQUERDO

4020 IF S%=15 THEN S%=18 ELSE S%=15
4030 Y%=Y%+8:TY%=TY%+1:GOSUB 9200
4040 XU%=TILE(RX%+1,RY%) ':PUT TILE XU%,(3,4)
4050 IF US%=1 AND (XU%=128 OR XU%=148) THEN US%=0
4090 RETURN

'DEBUG
5000 'LOCATE 0,0:PRINT STRING$(40," ")
5010 'LOCATE 0,23 : PRINT TIME, " - US%",US%
5020 'K% = INKEY:IF K%=13 THEN RETURN ELSE GOTO 5020
5060 RETURN 
'5000 RETURN 

'**********************************************************************************************/
' CONFIGURAÇÃO INICIAL
'**********************************************************************************************/

' INICIALIZA TELA
10000 COLOR 15,0,0:SCREEN 2,2,0
10002 SET TILE ON  
10005 CMD WRTSPR  4        ' Load sprite resource
'10007 CMD PLYLOAD 0, 1     ' Load music and sound effect resource
'10008 CMD PLYSONG 0        ' Load game song theme (Bach Invention 14)
'10009 CMD PLYPLAY          ' Play theme
'10023 SET TILE COLOR 164,0
'10024 SET TILE COLOR 156,0
10030 RETURN    

'==== DEFINE VARIÁVEIS INICIAL
10200 T1%=TIME:P%=TL%-5         
10220 SD%=1:SE%=1
10230 Q%=0:ST%=0:VQ%=T1%    'CONTROLE DA QUEDA
10240 JP%=0                 'PULO
10250 F%=0                  'FIM DE JOGO
10252 DIM TL$(4)
10260 RETURN

'==== FUNÇÃO TELA NOVA
10300 CMD DISSCR
10301 CMD WRTCHR 2       ' Load tiles patterns resource
10302 CMD WRTCLR 3       ' Load tiles colors resource
10303 CMD WRTSPR 4
10305 CMD WRTSCR TL%
'10330 LOCATE 8, 0:PRINT "CALEBE ADVENTURE";
10340 LOCATE 0,23:PRINT "LIFE"
10341 GOSUB 3251 'IMPRIME PONTUAÇÃO

10360 CMD SETFNT  1
10365 SET TILE COLOR 164,0:SET TILE COLOR 190,0
10366 SET TILE COLOR 156,0:SET TILE COLOR 169,0
10377 GOSUB 8650'MOEDA
10378 GOSUB 8740'CHAVE
10379 GOSUB 8900'VER PORTÃO ABERTO
10370 CMD ENASCR   
10380 RETURN

'====
10420 GOSUB 10200       'CONFIGURAÇÃO INICIAL
10430 GOSUB 10300       'FUNCAO TELA

' Altera cor das colunasd na tela 5
'10431 IF TL%>=9 THEN FOR I%=208 TO 213 STEP 2:SET TILE COLOR I%,11:NEXT I%

10500 GOSUB 9200        'EXIBE JOGADOR
'LOOP
10510 GOSUB 9100        'GET USER INPUT
10520 GOSUB 9300        'MOVIMENTOS HEROI
10530 GOSUB 9600        'PULO
10540 GOSUB 9500        'QUEDA LIVRE
10531 GOSUB 3391        'LUZ DA TOCHA
10550 GOSUB 10561       'ZERA O TIMER

'DESVIA DOS EVENTOS TELA AZUL


10532 IF TL%=11              THEN 10510 
10533 IF TL%>=10 AND TL%<=13 THEN 9800 

'TELA INICIAL

'*******************************

10551 IF TL%=5  OR TL%=8 THEN GOSUB 8200 'ALIEN
10552 IF TL%<7 THEN GOSUB 10720       'BAT
10553 IF TL%<7 THEN GOSUB 10800       'BAT 2
10554 IF TL%<7 THEN GOSUB 10900       'CARANGUEIJO
10555' LOCATE 0,20: PRINT TIME, J%,"SE",SE%,"SD",SD%,"US",US%
'10556 GOSUB 11000 'COLISÃO CARANGUEJO
10556 IF TL%<>9 AND TL%<>5              THEN GOSUB 7000  'GOTEIRA
10557 IF TL%<>9 AND TL%=5   AND TL%<>8  THEN GOSUB 10630 'RIVER
10558 IF TL%<>9 AND TL%<>5  AND TL%<>8  THEN GOSUB 8400  'FANTASMINHA
10559 IF TL%<>9 AND TL%=8   AND FE%=1   THEN GOSUB 8500  'ESPETOS

10560 GOTO 10510

'==== ZERA O TIME
10561 IF TIME<0 THEN TIME=0:VQ%=0:T1%=0:T%=0:VT%=0:T7%=0:DT4%=0:T4%=0:T5%=0:T11%=0:T13%=0:T14%=0:T15%=0:T10%=0:T16%=0
10562 RETURN

'==== TELA 1
'X%=8:Y%=79:TY%=12
10570 TL%=5                     'POISICAO INICIAL DO JOGADOR
10571 RP%=16:CP%=31                         'ABRE PORTÃO FASE 1
10572 US%=0                                 'UPSTAIR SOBE ESCADA ATIVADO
10573 VT%=T1%:CL%=9                         'LUZ DA TOCHA
10574 S7%=134:T7%=T1%: Y7%=21: X7%=13       'RIVER
10575 S4%=29:X4%=210:Y4%=50:T4%=T1%:D4%=1   'BAT
10576 S5%=29:LM5%=130:LS5%=110:X5%=210:Y5%=LS5%:T5%=T1%:D5%=2:DY%=-1  ' BAT 2 LM5%=LIMITE DA DESCIDA LS5% LIMITE SUBIDA
10577 LE11%=7:X11%=LE11%:Y11%=20:T11%=T1%:D11%=-1                    ' CARANGUEJO
10578 CL10%=12:MS10%=33:S10%=MS10%:X10%=152:Y10%=151:T10%=T1%:D10%=-3:MD10%=D10%     ' ALIEN
10579 T16%=T1% 'time pulo

10582 GOTO 10420

'==== TELA 2
'X%=232:
10600 TL%=6 : IF A%=1 THEN X%=232 ELSE X%=8
10601 RP%=7:CP%=0     'ABRE PORTÃO FASE 2 
10602 T13%=T1%:X13%=7:MY13%=6:Y13%=MY13%:F1%=0:LT%=30 'GOTEIRA
10603 X14%=27:Y14%=19:T14%=T1%:D14%=-1 :  C14%=0: T15%=T1%'FANTASMINHA
10604 GOTO 10420

'==== TELA 3
10605 TL%=7 
10606 T13%=T1%:X13%=16:MY13%=6:Y13%=MY13%:F1%=0:LT%=30 'GOTEIRA
10608 GOTO 10420

'==== TELA 4
11100 TL%=8
11101 CP%=6:RP%=9 
11102 CL10%=14:MS10%=35:X10%=230:Y10%=151:T10%=T1%:D10%=-3:MD10%=D10%     ' ALIEN
11103 T13%=T1%:X13%=17:MY13%=14:Y13%=MY13%:F1%=0:LT%=15 'GOTEIRA
11104 XES%=15:YES%=11 'LANÇA
11105 GOTO 10420

'==== TELA 6
11110 TL%=10 
'*ALIEN
11111 CL10%=13:MS10%=33:X10%=152:Y10%=151:T10%=TIME:D10%=-3:MD10%=D10%     ' ALIEN
'*BAT 2 LM5%=LIMITE DA DESCIDA LS5% LIMITE SUBIDA
11112 S5%=29:LM5%=115:LS5%=90:X5%=210:Y5%=LS5%:T5%=T1%:D5%=2:DY%=-1  
11115 GOTO 10420

'==== TELA 7
11200 TL%=11:X%=8:X10%=152:Y%=151:TY%=21:S%=0:CL10%=14:RP%=18:CP%=27:GOTO 10420

'==== TELA 8
11116 TL%=12:X10%=152:CL10%=11:GOTO 10420

'==== TELA 9
11117 TL%=13:CL10%=14:X10%=152:GOTO 10420


'===> RIVER
10630 IF TIME-T7%<60 THEN RETURN 
10631 T7%=TIME
10650 IF S7%=151 THEN S7%=134 ELSE S7%=151
10660 FOR A%=0 TO 4
10670   PUT TILE S7%,(X7%+A%,Y7%)
10680 NEXT A
10690 RETURN

'DIRECIONA mudança entre telas

'******************************************************************************************
'=== ESQUERDA
 '10701 LOCATE 1,1:PRINT RX%,RY%:K% = INKEY:IF K%=13 THEN 10703 ELSE  10701
'10701 LOCATE 0,1:PRINT "ESQ - TELA",TL% :K% = INKEY:IF K%=13 THEN 10703 ELSE  10701
 10700 A%=TL%-4:X%=232
 '                 1>2  2>3   3  4>1   5 6 7  8>6   9>8
10703 ON A% GOTO 10600,10605, 0 ,10570,0,0,0,11110,11116:GOTO 10715
'******************************************************************************************


'******************************************************************************************
'=== DIREITA
 10712 A%=TL%-4:X%=8
 10713 'LOCATE 0,1:PRINT "TELA",TL% :K% = INKEY:IF K%=13 THEN 10714 ELSE  10713
'                 4>1   2>1   3>2    4>6      6>8     8>9                            
 10714 ON A% GOTO 11100,10570,10600, 11110 ,0,11116,0,11117:GOTO 10715
 
 10715 LOCATE 0,0:PRINT "SEM TELA":GOTO 10715
'******************************************************************************************





'===> BAT
10720 IF TIME-T4%<6 THEN RETURN
10730 T4%=TIME
10740 IF S4%>=28 AND S4%<32 THEN S4%=S4%+1 ELSE S4%=29 
10750 IF X4%>=230 OR X4%<=200  THEN D4%=D4%*-1
'10770 X4%=X4%+D4%

10751 PX%=X%-X4%:PY%=Y%-Y4%
10752 IF (ABS(PX%)>ABS(PY%)) THEN X4%=X4%+1*SGN(PX%) ELSE Y4%=Y4%+1*SGN(PY%)

10780 PUT SPRITE 4,(X4%,Y4%),12,S4%
10790 RETURN

'===> BAT 2
10800 IF TIME-T5%<4 THEN RETURN
10810 T5%=TIME
10811 IF WB%=3 THEN WB%=0:GOSUB 10891
'10820 IF S5%>=28 AND S5%<32 THEN S5%=S5%+1 ELSE S5%=29 
10830 IF X5%>=220 OR X5%<=50	THEN D5%=D5%*-1
10850 IF Y5%=LS5% OR Y5%=LM5%	THEN DY%=DY%*-1 
10870 Y5%=Y5%+DY%:X5%=X5%+D5%
10880 PUT SPRITE 5,(X5%,Y5%),5,S5%
10881 WB%=WB%+1
10890 RETURN

10891 IF S5%>=28 AND S5%<32 THEN S5%=S5%+1 ELSE S5%=29 
10892 RETURN


'==== CARANGUEJO
10900 IF TIME-T11%<20 THEN RETURN
10910 T11%=TIME
10940 IF D11%=-1 THEN GOSUB 10973 ELSE GOSUB 10980 'GOSUB 10971  'EXIBE CARANGUEJO
10950 X11%=X11%+D11%
10960 IF S11%=1 THEN S11%=0:TL11%=182 ELSE S11%=1:TL11%=184
10966 GOSUB 11000 'VER COLISÃO 
10970 RETURN
'==== VÁ PARA ESQUERDA
10973 IF TILE(X11%,Y11%)<>0   THEN D11%=1:RETURN 'TEM ALGO NA FRENTE
'10974 PUT TILE TL11%,(X11%,Y11%):PUT TILE TL11%+1,(X11%+1,Y11%):PUT TILE 0,(X11%+2,Y11%) 
10974 LOCATE X11%,Y11%:PRINT CHR$(TL11%)+CHR$(TL11%+1)+CHR$(0)
10975 RETURN 
'==== VÁ PARA DIREITA
10980 IF TILE(X11%+2,Y11%)<>0  THEN D11%=-1:RETURN 'TEM ALGO NA FRENTE
'10988 PUT TILE 0,(X11%,Y11%):PUT TILE TL11%,(X11%+1,Y11%) :PUT TILE TL11%+1,(X11%+2,Y11%)
10988 LOCATE X11%,Y11%:PRINT CHR$(0)+CHR$(TL11%)+CHR$(TL11%+1)
10989 RETURN 
'==== COLISÃO CARANGUEJO
11000 CT%=TILE(X%/8,TY%-1)
11020 IF CT%>=182 AND CT%<=185  THEN GOSUB 5000 'GOSUB 10100 'reduz coração
11030 RETURN

'==== COLISÃO MOEDA
 11040 FOR A%=0 TO 1
 11043      IF TILE(RX%+A%,RY%-2)=147 THEN PX%=RX%+A%:PY%=RY%-2:GOSUB 8620 'PONTUA MOEDA
 11044 NEXT A%
 11045 RETURN

'ABRE BAÚ
11080 GOSUB 11086 'ZERA A CHAVE ATIVA
11081 FOR A%=1 TO 2:PUT TILE   0,(RX%+3,RY%-A%):PUT TILE   0,(RX%+4,RY%-A%):NEXT A%
11082 PUT TILE 222,(RX%+2,RY%-3):PUT TILE 223,(RX%+3,RY%-3)
11085 RETURN

'UTILIZA A CHAVE
11086 FM%=0:PUT TILE 0,(30,2):RETURN


'11040 '===> COLISÃO DE SPRITES
'11045 DT8%=TIME-T8%:IF DT8%<5 THEN RETURN
'11050 T8%=TIME
'11055 IF COLLISION(0, 5)>0 THEN GOSUB 10100:RETURN              'BAT 2
'11060 IF COLLISION(0, 3)>0 THEN GOSUB 10100:GOSUB 10200: RETURN 'FOGO 
'11065 GOSUB 10020 'VERIFICA COLISÃO DE TILE
'11070 RETURN

'******************************************************************************
'==== GOTEIRA
'******************************************************************************
7000 IF TIME-T13%<LT% THEN RETURN 
7001 T13%=TIME
7002 ON F1% GOTO 7020,7030,0,7040,7045,7046,7047:GOTO 7010
'=== DESVIOS
7010 F1%=1:TG%=193:GOTO 8000 
7020 F1%=2:TG%=194:GOTO 8000 
7030 F1%=4:TG%=195:GOTO 8000 
7040 LT%=10:F1%=5:Y13%=Y13%+1:GOTO 8000 
7045 Y13%=Y13%+1:GOTO 8000              'CAINDO
7046 TG%=196:GOSUB 8000:F1%=7:RETURN    'COLIDIU
7047 TG%=0  :GOSUB 8000:F1%=0:Y13%=MY13%:LT%=30:RETURN
'=== EXIBE GOTEIRA
8000 PUT TILE TG%,(X13%,Y13%)':LOCATE 0,0:PRINT F1%,TG%
8012 IF F1%=5 THEN  PUT TILE 0,(X13%,Y13%-1):GOSUB 8100 'APAGA RASTRO QDO ESTÁ CAINDO
8013 IF TILE(X13%,Y13%+1)<>0 THEN F1%=6      'COLISÃO COM O CHÃO
8090 RETURN
'=== COLISAO
8100 CT%=TILE(X%/8,TY%-3):CK%=TILE(X%/8+1,TY%-3)
8110 IF CT%=195 OR CK%=195 THEN F1%=6:GOTO 7046 'GOSUB 10100 'reduz coração
8120 RETURN
'******************************************************************************

'******************************************************************************
'=== ALIEN
'******************************************************************************
8200 IF TIME-T10%<12 THEN RETURN  
8211 T10%=TIME
'8212 LOCATE 0,2:PRINT "WK",WK%,"S10",S10%
8213 IF WK%=2 THEN CH%=1:WK%=0:GOSUB 8301 ELSE CH%=0
8230 
8240 MD10%=D10%
8250 IF TILE (X10%/8+1,Y10%/8+2)=167 THEN D10%=D10% * -1
8270 X10%=X10%+D10%
8280 IF MD10%<>D10% THEN SET SPRITE FLIP 35,0:SET SPRITE FLIP 36,0:MD10%=D10%
8290 PUT SPRITE 6,(X10%,Y10%),CL10%,S10%
8291 WK%=WK%+1
8300 RETURN
'TROCA SPRITE
8301 IF S10%=MS10%+1 THEN S10%=MS10% ELSE S10%=MS10%+1
8302 RETURN

'******************************************************************************
'==== FANSTASMINHA
'******************************************************************************

8400 IF TIME-T15%<5 THEN GOTO 8405  
8401 T15%=TIME:IF C14%<>15 THEN C14%=15 ELSE C14%=0
'8402 FOR A%=197 TO 198
'8403    SET TILE COLOR A%,C14%
'8404 NEXT A%
8405 IF TIME-T14%<10 THEN RETURN  
8406 T14%=TIME
8415 IF D14%=-1 THEN GOSUB 8440 ELSE GOSUB 8455 'GOSUB 10971  'EXIBE FANSTASMINHA
8425 IF S14%=1 THEN S14%=0 ELSE S14%=1
'8430 GOSUB 11000 'VER COLISÃO 
8435 RETURN
'==== VÁ PARA ESQUERDA
8440 GOSUB 8466:X14%=X14%+D14%:GOSUB 8468:GOSUB 8467
8450 RETURN 
'==== VÁ PARA DIREITA
8455 GOSUB 8466:GOSUB 8468:X14%=X14%+D14%:GOSUB 8468:GOSUB 8467
8465 RETURN 
'=== EXIBE FANTASMA
8466 PUT TILE   0,(X14%,Y14%):PUT TILE   0,(X14%,Y14%+1):RETURN 
8467 PUT TILE 197,(X14%,Y14%):PUT TILE 198,(X14%,Y14%+1):RETURN
'=== VERIFICA LIMITE DO FANTASMA
8468 IF TILE(X14%+D14%,Y11%)<>0 OR TILE(X14%+D14%,Y11%-1)<>0 THEN D14%=D14%*-1:RETURN 'TEM ALGO NA FRENTE
'==== COLISÃO FANSTASMINHA
'8470 CT%=TILE(X%/8,TY%-1)
'8475 IF CT%>=182  AND CT%<=185  THEN GOSUB 5000 'GOSUB 10100 'reduz coração
'8480 RETURN
'******************************************************************************

'=== ESPETOS
8500 IF TIME-T14%<15 THEN RETURN 
8501 T14%=TIME 
8502 IF EP%=200 THEN  EP%=199 ELSE EP%=200
8503 PUT TILE EP%,(XES%,YES%)
8504 RETURN

'=== VERIFICA SE A MOEDA JÁ FOI PEGA

 8620 'GUARDA POSIÇÃO DA MOEDA
 8625 MXY%(P%,0) = PX% 
 8626 MXY%(P%,1) = PY% 
 8627 GOSUB 8660 'LIMPA MOEDA
 8631 GOSUB 3200 'PONTUA
 8635 RETURN

 8650 'LIMPA A MOEDA
 8655 IF MXY%(P%,0)=0 THEN RETURN
 8660 PUT TILE 0,(MXY%(P%,0),MXY%(P%,1))
 8670 RETURN

 8700 'GUARDA POSIÇÃO CHAVE
 8705 ON FM% GOTO 8730
 8706 FM%=1
 8710 OBP%(P%,0)=PX%  'TELA, OBJ, X
 8715 OBP%(P%,1)=PY%  'TELA, OBJ, Y
 8720 GOSUB 8750 'LIMPA CHAVE
 8730 RETURN

 ' EXIBE/ESCONDE  A CHAVE
 8740 ON FM% GOTO 8750
 8742 IF OBP%(P%,0)=0 THEN RETURN
 8750 PUT TILE 0,(OBP%(P%,0),OBP%(P%,1))
 8751 IF FM%=1 THEN PUT TILE 172,(30,2)
 8760 RETURN


'=== ALAVANCA ESQUERDA/DIREITA
8800 IF PX%<10 THEN CA%=203 ELSE CA%=219 
8810 PUT TILE   0,(PX%,PY%):PUT TILE CA%,(PX%,PY%+1)
8811 POR%(P%,0)=PX%:POR%(P%,1)=PY%
8812 POR%(P%,2)=CA%
8813 GOSUB 3110 'ABRE O PORTÃO
8814 RETURN


'=== VERIFICA SE PORTÃO ESTÁ ABERTO
'=== DESABILITA PORTÃO
'8900 P%=TL%-5
8900 IF POR%(P%,0)=0 THEN RETURN
8904 FOR A%=0 TO 4
8905    PUT TILE 164,(CP%,RP%+A%)   'PUT TILE 190,(RP%,CP%+A%)
8910 NEXT A%
'8911 LOCATE 0,0: PRINT "PASSEI",POR%(P%,0),POR%(P%,1)
8912 CA% = POR%(P%,2)
8913 PUT TILE   0,(POR%(P%,0) , POR%(P%,1))
8914 PUT TILE CA%,(POR%(P%,0) , POR%(P%,1)+1)
8915 RETURN

'8920 GOSUB 8900
'8930 RETURN

 
'=== ABRE O PORTÃO
9000 Z%=2
9010 FOR X0%=0 to 3
9020    IF TIME-T%<20 THEN 9020 
9030    T%=TIME
9040    FOR A%=1 TO Z%
9050        COPY (CP%,RP%+A%)-(CP%+1,RP%+A%) TO TL$(A%-1)
9060        COPY TL$(A%-1) TO (CP%,RP%+A%-1)
9070    NEXT A%
9080    IF X0%=0 THEN FOR C%=0 TO 1:PUT TILE 169,(CP%+C%,RP%+2):NEXT C% ELSE Z%=Z%-1
9090 NEXT X0%
9091 RETURN

'FLUXO DE EVENTOS TELA AZUL
'TELA 10 , 12, 13
9800 '
9810 GOSUB 8200  'ALIEN
9811 GOSUB 10800 'BAT 2  
9850 GOTO 10510  'VOLTA PRO LOOP

' 'TELA 8
' 9860 '
' 9861 GOTO 10510


'ENTRA NO PORTAL
9880 FOR W%=1 TO 6
9882    IF S%=15 THEN S%=18 ELSE S%=15
9883    GOSUB 9200 
9884    IF TIME-T%<20 THEN 9884 
9885    T%=TIME
9386 NEXT W%
9387 'K% = INKEY:IF K%=13 THEN 9388 ELSE 9387
9388 IF TL%=8  THEN X%=24:Y%=151:TY%=21:S%=0:GOTO 11110
9389 IF TL%=11 THEN X%=8:Y%=79:TY%=12:S%=0:GOTO 10570


