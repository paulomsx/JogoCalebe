FILE "gd1.akm"            ' 0 - Music (exported from Arkos Tracker 2)
FILE "gd1.akx"            ' 1 - Sound Effects (expord from Arkos Tracker 2)

FILE "TILES.chr.plet5"  ' 2 - Tiles Patterns (exported from nMSXTiles)
FILE "TILES.clr.plet5"  ' 3 - Tiles Colors (exported from nMSXTiles)

FILE "S8.SPR"           ' 4 - Sprites (exported from TinySprite)

FILE "TELA1.plet5"      ' 5 - Tela 1 
FILE "TELA2.plet5"      ' 6 - Tela 2 
FILE "TELA3.plet5"      ' 7 - Tela 3
FILE "TELA4.plet5"      ' 8 - Tela 4

11 X%=8:Y%=79:TY%=12:S%=0  'POISICAO INICIAL DO JOGADOR
12 DX%=8:S%=0         'POSIÇÃO INICIAL CANTO ESQUERDA - VIRADO PARA DIREITA
13 RP%=16:CP%=31      'ABRE PORTÃO
14 SC%=0              'SCORE Score

10 GOSUB 10000       'INICIALIZA GAME
20 GOSUB 10200       'DEFINE VARIÁVEIS INICIAIS
30 GOTO  10570       'INICIALIZA JOGO

'===>GET USER INPUT
9100 K% = INKEY
9101 J% = STICK(0) OR STICK(1)
9102 B% = STRIG(0) OR STRIG(1)
9105 RETURN
 
'===>EXIBE JOGADOR
'9200 IF JP%>0 THEN IF DI%=-1 THEN S%=6 ELSE S%=3 '**** DEFINE O SPRITE NO PULO
9200 IF JP%>0 THEN IF DI%=-1 THEN S%=24 ELSE S%=21 '**** DEFINE O SPRITE NO PULO
9201 PUT SPRITE  0,(X%,Y%), 4,S%   'COR AZUL
9202 PUT SPRITE  1,(X%,Y%), 9,S%+1 'COR BRANCA
9203 PUT SPRITE  2,(X%,Y%),15,S%+2 'COR PELE
9205 IF F%=1 THEN RETURN
9206 GOSUB 9220  'VER PISO 
9207 GOSUB 9400  'ATUALIZA POSIÇÃO DO TILE DO JOGADOR
9208 GOSUB 11040 'VER COLISÃO MOEDA
9209 GOSUB 11000 'VER COLISÃO TILE CARANGUEJO
9210 RETURN

'===>PEGA O TILE DO JOGADOR
9220 'PUT TILE 0,(RX%,RY%-2):PUT TILE 0,(RX%+1,RY%-2) 'PARA RASTREAR
9221 RX%  = X%/8:RY%=TY%
9222 CF%  = TILE(RX%,RY%)   'TILE PISO  
9223 CF2% = TILE(RX%+1,RY%) 'TILE PISO    
'9224 PUT TILE CF%,(RX%,RY%-3) 'PARA RASTREAR
'9225 PUT TILE CF2%,(RX%+1,RY%-3) 'PARA RASTREAR
9226 RETURN

'**********************************************************************************************/
' ** MOVIMENTO DO JOGADOR
'**********************************************************************************************/
9300 IF ST%=1                       THEN RETURN 'SE TIVER EM QUEDA NÃO MOVIMENTA AS SETAS
9320 DT%=TIME-T1%:IF DT%<7          THEN RETURN ELSE T1%=TIME 'TIME
'SOBE
9321 IF J%=1                        THEN GOSUB 3300:RETURN 'GOSUB 9374:GOSUB 9200:RETURN 'CIMA
'DESCE
9322 IF J%=5                       THEN GOSUB 4000:RETURN 'GOSUB 9374:GOSUB 9200:RETURN 'CIMA
'PULO
9323 IF JP%=0   AND US%<>1          THEN IF B%<>0 THEN JP%=6:SE%=1:SD%=1:RETURN           'PULO
' COLOQUEI SD% E SE% = 1 PARA QDO O PERSONAGEM PULAR QDO ESTIVER DO LADO DO BLOCO E NÃO ENTRAR NA CAIXA
9325 IF J%=3  AND SD%=1  AND US%<>1 THEN SE%=1:GOSUB 9360:RETURN 'DIREITA
9326 IF J%=7  AND SE%=1  AND US%<>1 THEN SD%=1:GOSUB 9350:RETURN 'ESQUERDA
9327 IF J%=0 AND S%<>0 AND S%<>9    THEN GOSUB 9460:RETURN  'DEFINE POSIÇÃO SENTIDO
9340 RETURN

' 9341 PRINT 10,10:PRINT "DEBUG" , "DX", DX%
' 9342 GOSUB 5000
'**********************************************************************************************/

'**********************************************************************************************/
'MOVE ESQUERDA
'**********************************************************************************************/
9350 ES%=TILE(RX%-2,RY%-2) 
9351 GOSUB 9700 'VERIFICA SE HÁ PAREDE DO LADO ESQUERDO
9352 IF SE%=0 THEN SE%=1:RETURN
9353 DI%=-1:DX% =-8:X%=X%+DX%:IF S%=6 THEN S%=9 ELSE S%=6 
9355 GOSUB 9200 'EXIBE JOGADOR
9358 RETURN 

'=== VERIFICA SE HÁ PAREDE OU PORTÃO DO LADO ESQUERDO -  BLOCO VERMELHO
9700 IF RX%-1<0 THEN GOTO 9375'SAI À ESQUERDA
9701 XT%=TILE(RX%-1,RY%-1) ':XD%=TILE(RX%-1,RY%)
9702 XU%=TILE(RX%-1,RY%-2)   'VER MOEDA
'9710 IF XT%=170 OR XT%=153 OR XT%=152 OR XD%=152 OR XD%=153 THEN SE%=0  ELSE SE%=1 'BLOCO VERMELHO (PAREDE)
9710 IF XT%=170 OR XT%=152  THEN SE%=0  ELSE SE%=1 'BLOCO VERMELHO (PAREDE)
9711 IF XT%=157 THEN SE%=0:RETURN 'GOSUB 3110 'PORTAL VERDE
9712 IF XU%=147 THEN PUT TILE 0,(RX%-1,RY%-2):GOSUB 3200 ' PEGA MOEDA
9713 IF XU%=172 THEN GOSUB 9760   ':GOSUB 3200 ' PEGA CHAVE
9714 IF XU%=201 THEN GOSUB 11070 'ALAVANCA
9715 IF XT%=156 THEN FE%=1 'ATIVA ESPETO
'9716 PUT TILE XT%,(0,0):PUT TILE XU%,(0,1)
9719 RETURN 

'PEGA CHAVE
9760 IF FM%=1 THEN RETURN ELSE FM%=1 
9761 PUT TILE 0,(RX%-1,RY%-2)
9762 PUT TILE 172,(30,2)
9763 RETURN




'=== VER SE TEM SAÍDA A ESQUERDA
9375 XT%=TILE(RX%+1,RY%-2)
9379 IF XT%=164 OR XT%=190 THEN GOTO 10700 ' saída parede
'9380 IF XT%=190 THEN GOTO 10700 ' saída porta
382 RETURN
'**********************************************************************************************/

'**********************************************************************************************/
'DIREITA
'**********************************************************************************************/
9360 DR%=TILE(RX%+3,RY%-2) 'DIREITA
9362 GOSUB 9720 'VERIFICA A DIREITA
9363 IF SD%=0 THEN SD%=1:RETURN
9366 DI%=1:DX%=8:X%=X%+DX%:IF S%=3 THEN S%=0 ELSE S%=3 
9367 GOSUB 9200 'EXIBE JOGADOR
9377 RETURN
 
'=== VERIFICA SE HÁ PAREDE OU PORTÃO DO LADO DIREITO -  BLOCO VERMELHO
9720 IF RX%>30 THEN GOTO 9730   'SAI A DIREITA
9721 XT%=TILE(RX%+2,RY%-1)   'PUT TILE XT%,(0,1)
'9722 XD%=TILE(RX%+2,RY%)     'TRATA PARECE E BLOQUINHO SOLTO NO CHÃO
9723 XU%=TILE(RX%+2,RY%-2)   'VER MOEDA
'9724 PUT TILE XT%,(20,2):PUT TILE XD%,(21,2):PUT TILE XU%,(22,2)
 9724 KK%=TILE(RX%+3,RY%-1)':PUT TILE KK%,(20,2)
'9726 IF XT%=170 OR XT%=152 OR XT%=153 OR XE%=153 OR XE%=152 OR XD%=153 OR XD%=152 THEN SD%=0 ELSE SD%=1 'BLOCO VERMELHO (PAREDE)
9725 IF XT%=170 OR XT%=152 THEN SD%=0  ELSE SD%=1 'BLOCO VERMELHO (PAREDE)
9726 IF XT%=166 THEN SD%=0:RETURN 'SD%=0:AP%=1:GOSUB 3110 ' PORTA VERDE
9727 IF XU%=147 THEN PUT TILE 0,(RX%+2,RY%-2):GOSUB 3200 ' PEGA MOEDA
'9728 IF KK%=130 THEN GOSUB 5000 'BAÚ
9728 IF TILE(RX%+3,RY%-1)=130 AND FM%=1 THEN GOSUB 11080 'BAÚ
9781 IF XU%=221 THEN GOSUB 11070 'ALAVANCA
9729 RETURN 

'=== VER SE TEM SAÍDA A DIREITA
9730 XT%=TILE(RX%,RY%-2) ': LOCATE 1,2:PRINT RX%:PUT TILE 179,(28,2):PUT TILE XT%,(29,2):PUT TILE 134,(RX%,RY%-4)
9740 IF XT%=164 OR XT%=190 THEN GOTO  10711 '10570 'FASE 1 -
'9741 IF XT%=190 THEN GOTO  10700 '10570 'FASE 1 -
9750 RETURN

'=== ABRE A PORTA
'9760 X1%=TILE(RX%+2,RY%-1)  
'9770 IF RX%=29 AND (X1%=152 OR X1%=153) AND AP%=0 THEN AP%=1:GOSUB 3110 ELSE RETURN
'9780 LOCATE 0,0:PRINT "RX",RX%,"X1",X1%,"SD",SD%
'9786 SD%=1
'9790 RETURN
'**********************************************************************************************/

'**********************************************************************************************/
' CONTROLE DA QUEDA
'**********************************************************************************************/
9400 IF US%=1 THEN RETURN  ' SUBINDO ESCADA
'9401 IF CF%<>174 AND CF2%<>174 AND CF%<>173 AND CF2%<>173 AND CF%<>153 AND CF2%<>153 AND CF%<>152 AND CF2%<>152 AND CF%<>128 AND CF2%<>128 AND CF%<>155 AND CF2%<>155 AND JP%=0 THEN GOSUB 9420 ELSE GOSUB 9440  '=== VERIFICA PISO

9401 IF CF%<>174 AND CF2%<>174 AND CF%<>173 AND CF2%<>173 AND CF%<>152 AND CF2%<>152 AND CF%<>128 AND CF2%<>128 AND CF%<>155 AND CF2%<>155 AND JP%=0 THEN GOSUB 9420 ELSE GOSUB 9440  '=== VERIFICA PISO

9403 IF CF%=135 OR CF2%=135  THEN GOTO 3090 ' CAIU NO RIO
9410 RETURN

'=== QUEDA LIGADA
9420 Q%=8:ST%=1
9430 RETURN

'=== QUEDA DESLIGADA
9440 IF ST%=0 THEN RETURN
9441 Q%=0:ST%=0 
'    NO FINAL DA QUEDA IDENTIFICA OS CARACTERES A DIREITA E A ESQUEDA

9442 DR%=TILE(RX%+2,RY%-2):IF DR%=152   THEN SD%=0 ELSE SD%=1
9444 ES%=TILE(RX%-1,RY%-2):IF ES%=152  THEN SE%=0 ELSE SE%=1

'9345 PUT TILE ES%,(0,1):PUT TILE DR%,(2,1)
'9346 LOCATE 0,0:PRINT STRING$(40," "):LOCATE 0,0:PRINT "E-D",TIME
9450 RETURN

'=== QUEDA LIVRE
9500 IF Q%=0 THEN RETURN 
'9501 TQ%=TIME-VQ%:IF TQ%<6 THEN RETURN ELSE VQ%=TIME ' CONTROLA VELOCIDADE DA QUEDA
9501 IF TIME-VQ%<6 THEN RETURN ELSE VQ%=TIME ' CONTROLA VELOCIDADE DA QUEDA
9508 IF J%=1 THEN Q%=0:ST%=0:RETURN '****SETA PRA CIMA
9510 GOSUB 9400 'CONTROLE DA QUEDA
9520 IF Q%=0 THEN RETURN
9522 GOSUB 9460 'CAI EM PÉ
9530 Y%=Y%+Q%:TY%=TY%+ST%
9590 RETURN
'**********************************************************************************************/

'**********************************************************************************************/
'PULO
'**********************************************************************************************/
9600 IF JP%=0 THEN RETURN
9601 IF TIME-T16%<5 THEN RETURN ELSE T16%=TIME
9602 IF JP%=6  THEN GOSUB 9470 'VER SE TILE ACIMA É TETO
9603 IF XT%=168 OR XV%=168 THEN J%=0:JP%=0:RETURN 'SE FOR CANCELA O PULO
'168=TETO
9609 IF TIME-T12%<4 THEN RETURN ELSE T12%=TIME
9620 JP%=JP%-1                           
9630 IF JP% > 3 THEN GOSUB 9671 ELSE IF JP%<1 THEN GOSUB 9383':GOSUB 9200:RETURN 'SOBE
' 9630 IF JP% > 3 THEN GOSUB 9671 
' 9640 IF JP% < 1 THEN GOSUB 9383 
9641 GOSUB 9200
9670 RETURN

'=== VERIFICA O TILE DE CIMA E DECIDE SE CANCELA O PULO
9470 XT%=TILE(RX%,TY%-3)
9471 XV%=TILE(RX%+1,TY%-3) 
'9472 LOCATE 10,0:PRINT CHR$(XT%) 'PUT TILE XT%,(0,0)
9473 RETURN'

'=== PULO CIMA
'9671 XU%=TILE(RX%,TY%-3):XV%=TILE(RX%+1,TY%-3):PUT TILE XU%,(0,0):PUT TILE XV%,(1,0)
9671 GOSUB 9470 'VER TETO
'9672 GOSUB 9680 'VER CHAVE
9672 IF XT%=168 OR XV%=168 THEN JP%=2:RETURN  ' 168=TETO
9673 IF XT%=172 OR XV%=172 THEN GOSUB 3170     ' 172 - CHAVE
9374 Y%=Y%-8:TY%=TY%-1
9675 RETURN

'PEGA CHAVE
'9680 IF XT%=172 OR XV%=172 THEN GOTO 3170 ' 172 - CHAVE
'9689 RETURN

'=== DESCE APÓS O PULO
9383 Y%=Y%+8:TY%=TY%+1:RETURN

'=== DEFINE POSIÇÃO SENTIDO (APÓS QUEDA OU PULO)
9460 IF US%=1 THEN RETURN 'SUBINDO ESCADA
9463 IF DX%<0 THEN S%=9 ELSE S%=0 
9464 GOSUB 9200
9465 RETURN 

'**********************************************************************************************/

'=== GAME OVER
'=== CAIU NO RIO

3090 F%=1:S%=12:GOSUB 9200:LX%=9:LY%=11
'3094  PUT TILE 193, (LX%,LY%): FOR A%=1 TO 11:PUT TILE 194, (LX%+A%,LY%):NEXT A%:       PUT TILE 195, (LX%+12,LY%)
'3095  PUT TILE 199, (LX%,LY%+1):LOCATE LX%+1,LY%+1:PRINT " GAME OVER ":                 PUT TILE 200, (LX%+12,LY%+1)
'3096  PUT TILE 196, (LX%,LY%+2): FOR A%=1 TO 11:PUT TILE 197, (LX%+A%,LY%+2):NEXT A%:   PUT TILE 198, (LX%+12,LY%+2)

'3094 MT%=181:GOSUB 3098:LOCATE LX%,LY%:PRINT CHR$(181)+LN$+CHR$(181)
'3095 LOCATE LX%,LY%+1:PRINT CHR$(181)+" GAME OVER "+CHR$(181)
'3096 MT%=181:GOSUB 3098:LOCATE LX%,LY%+2:PRINT CHR$(181)+LN$+CHR$(181)
'3097 GOTO 3097
'3098 LN$="":FOR A%=1 TO 11:LN$=LN$+CHR$(MT%):NEXT A%:RETURN

3094 GOSUB 3098
3095 LOCATE LX%+2,LY%+1:PRINT "GAME OVER"
3097 GOTO 3097
3098 FOR Z%=0 TO 2:FOR A%=1 TO 11:PUT TILE 181,(LX%+A%,LY%+Z%):NEXT A%:NEXT Z%:RETURN

'=== ABRE O PORTÃO
3110 IF AP%=1 THEN AP%=0 ELSE RETURN
3111 Z%=4
3112 FOR X0%=0 to 4
3115    IF TIME-T%<10 THEN 3115 ELSE T%=TIME
3120    FOR A%=1 TO Z%
3125        COPY (CP%,RP%+A%)-(CP%,RP%+A%) TO TL$(A%-1)
3130        COPY TL$(A%-1) TO (CP%,RP%+A%-1)
3135    NEXT A%
3140    IF X0%=0 then PUT TILE 190,(CP%,RP%+4)
3145    IF X0%=2 THEN Z%=2
3150    IF X0%=3 THEN Z%=1
3155 NEXT X0%
3160 RETURN

'PEGA CHAVE
3170 IF FM%=1 THEN RETURN ELSE FM%=1
3171 GOSUB 3291
3172 RETURN

'PEGA MOEDA - PONTUA SCORE
3200 SC%=SC%+10:GOSUB 3251
3250 RETURN

3251 LOCATE 22,23: PRINT "SCORE:" ; USING "####"; SC%
3252 RETURN 

'APAGA OBJETO SELECIONADO
'3291 PUT TILE 0,(RX%, TY%-3): PUT TILE 0,(RX%+1, TY%-3) 
3291 FOR A%=0 TO 1:PUT TILE 0,(RX%+A%, TY%-3):NEXT A%
3282 PUT TILE 172,(30,2)
3293 RETURN

'=== SOBE
3300 IF US%=1 THEN GOTO 3320 'ATIVADO ESCADA
3305 XU%=TILE(RX%+1,RY%-2) ':PUT TILE XU%,(1,1)
3310 IF XU%=189 THEN US%=1 ELSE RETURN 'VERIFICA SE ESTÁ NA PONTA DA ESCADA PRA SUBIR
3320 IF S%=15 THEN S%=18 ELSE S%=15
3321 Y%=Y%-8:TY%=TY%-1:GOSUB 9200 
3322 XU%=TILE(RX%+1,RY%-1) ':PUT TILE XU%,(2,4)
3323 IF US%=1 AND XU%=0 THEN US%=0
3390 RETURN

'=== LUZ DA TOCHA
3391 IF TIME-VT%<20 THEN RETURN ELSE VT%=TIME 
3392 IF CL%<>6 THEN CL%=6 ELSE CL%=9
3393 SET TILE COLOR 160,CL%
3395 RETURN

'=== DESCE ESCADA
4000 IF US%=1 THEN GOTO 4020
4005 XU%=TILE(RX%+1,RY%) ':PUT TILE XU%,(2,4)
4010 IF XU%=174 THEN US%=1 ELSE RETURN 'VERIFICA SE ESTÁ NA PONTA DA ESCADA PRA SUBIR
4020 IF S%=15 THEN S%=18 ELSE S%=15
4030 Y%=Y%+8:TY%=TY%+1:GOSUB 9200
4040 XU%=TILE(RX%+1,RY%) ':PUT TILE XU%,(3,4)
4050 IF US%=1 AND XU%=128 THEN US%=0
4090 RETURN



'DEBUG
'5000 'LOCATE 0,0:PRINT STRING$(40," ")
'5010 LOCATE 0,23 : PRINT TIME, " - US%",US%
'5020 K% = INKEY:IF K%=13 THEN RETURN ELSE GOTO 5020
'5060 RETURN 
5000 RETURN 

'**********************************************************************************************/
' CONFIGURAÇÃO INICIAL
'**********************************************************************************************/

' INICIALIZA TELA
10000 COLOR 15,0,0:SCREEN 2,2,0
10002 SET TILE ON  
10005 CMD WRTSPR  4        ' Load sprite resource
'10007 CMD PLYLOAD 0, 1     ' Load music and sound effect resource
'10008 CMD PLYSONG 0        ' Load game song theme (Bach Invention 14)
'10009 CMD PLYPLAY          ' Play theme
'10023 SET TILE COLOR 164,0
'10024 SET TILE COLOR 156,0
10030 RETURN    

'==== DEFINE VARIÁVEIS INICIAL
10200 T1%=TIME         
10220 SD%=1:SE%=1
10230 Q%=0:ST%=0:VQ%=T1%    'CONTROLE DA QUEDA
10240 JP%=0:T12%=TIME       'JUMP
10250 F%=0                  'FIM DE JOGO
10252 DIM TL$(4)
'10153 FM%=0 'PEGOU A CHAVE
10260 RETURN

'==== FUNÇÃO TELA NOVA
10300 CMD DISSCR
10301 CMD WRTCHR 2       ' Load tiles patterns resource
10302 CMD WRTCLR 3       ' Load tiles colors resource
10303 CMD WRTSPR 4
10305 CMD WRTSCR TL%
'10330 LOCATE 8, 0:PRINT "CALEBE ADVENTURE";
10340 LOCATE 0,23:PRINT "LIFE"
10341 GOSUB 3251 'IMPRIME PONTUAÇÃO

10360 CMD SETFNT  1
10365 SET TILE COLOR 164,0:SET TILE COLOR 190,0
10366 SET TILE COLOR 156,0 
10370 CMD ENASCR   
10380 RETURN

'====
10420 GOSUB 10200       'CONFIGURAÇÃO INICIAL
10430 GOSUB 10300       'FUNCAO TELA

10500 GOSUB 9200        'EXIBE JOGADOR
'LOOP
10510 GOSUB 9100        'GET USER INPUT
10520 GOSUB 9300        'MOVIMENTOS HEROI
10530 GOSUB 9600        'PULO
10540 GOSUB 9500        'QUEDA LIVRE
10531 GOSUB 3391        'LUZ DA TOCHA
10550 GOSUB 10561       'ZERA O TIMER
'10551 IF TL%=2 THEN GOSUB 10630       'RIVER
10551 IF TL%=5  OR TL%=8 THEN GOSUB 8200 'ALIEN
10552 IF TL%<7 THEN GOSUB 10720       'BAT
10553 IF TL%<7 THEN GOSUB 10800       'BAT 2
10554 IF TL%<7 THEN GOSUB 10900       'CARANGUEIJO
10555' LOCATE 0,20: PRINT TIME, J%,"SE",SE%,"SD",SD%,"US",US%
'10556 GOSUB 11000 'COLISÃO CARANGUEJO
10556 IF TL%<>5  THEN GOSUB 7000            'GOTEIRA
10557 IF TL%=5  AND TL%<>8 THEN GOSUB 10630 'RIVER
10558 IF TL%<>5 AND TL%<>8 THEN GOSUB 8400  'FANTASMINHA
10559 IF TL%=8 AND FE%=1 THEN GOSUB 8500
10560 GOTO 10510

'==== ZERA O TIME
10561 IF TIME<0 THEN TIME=0:VQ%=0:T1%=0:T12%=0:T%=0:VT%=0:T7%=0:DT4%=0:T4%=0:T5%=0:T11%=0:T13%=0:T14%=0:T15%=0:T10%=0:T16%=0
 10562 RETURN

'==== FASE 1
10570 TL%=5:AP%=0                 'POISICAO INICIAL DO JOGADOR
'10570 X%=232:TL%=2:S%=0:AP%=0              'POISICAO INICIAL DO JOGADOR
10571 RP%=16:CP%=31                         'ABRE PORTÃO FASE 1
10572 US%=0                                 'UPSTAIR SOBE ESCADA ATIVADO
10573 VT%=T1%:CL%=9                         'LUZ DA TOCHA
10574 S7%=134:T7%=T1%: Y7%=21: X7%=13       'RIVER
10575 S4%=29:X4%=210:Y4%=60:T4%=T1%:D4%=1   'BAT
10576 S5%=29:LM5%=130:LS5%=110:X5%=210:Y5%=LS5%:T5%=T1%:D5%=1:DY%=1  ' BAT 2 LM5%=LIMITE DA DESCIDA LS5% LIMITE SUBIDA
10577 LE11%=7:X11%=LE11%:Y11%=20:T11%=T1%:D11%=-1                    ' CARANGUEJO
10578 CL10%=12:MS10%=33:X10%=230:Y10%=151:T10%=T1%:D10%=-3:MD10%=D10%     ' ALIEN
10579 T16%=T1% 'time pulo
10582 GOTO 10420

'==== FASE 2
'X%=232:
10600 TL%=6 'JOGADOR 
10601 RP%=7:CP%=0     'ABRE PORTÃO FASE 2 
10602 T13%=T1%:X13%=7:MY13%=6:Y13%=MY13%:F1%=0:LT%=30 'GOTEIRA
10603 X14%=27:Y14%=19:T14%=T1%:D14%=-1 :  C14%=0: T15%=T1%'FANTASMINHA
10604 GOTO 10420

'==== TELA 3
10605 X%=232:TL%=7 'JOGADOR 
10606 T13%=T1%:X13%=16:MY13%=6:Y13%=MY13%:F1%=0:LT%=30 'GOTEIRA
10608 GOTO 10420

'==== TELA 4
11100 X%=8:TL%=8 'JOGADOR 
'11101 T13%=T1%:X13%=16:MY13%=6:Y13%=MY13%:F1%=0:LT%=30 'GOTEIRA
11101 CL10%=14:MS10%=35:X10%=230:Y10%=151:T10%=T1%:D10%=-3:MD10%=D10%     ' ALIEN
11103 T13%=T1%:X13%=17:MY13%=14:Y13%=MY13%:F1%=0:LT%=15 'GOTEIRA
11104 XES%=15:YES%=11 'LANÇA
11105 GOTO 10420

'===> RIVER
10630 IF TIME-T7%<60 THEN RETURN ELSE T7%=TIME
10650 IF S7%=151 THEN S7%=134 ELSE S7%=151
10660 FOR A%=0 TO 4
10670   PUT TILE S7%,(X7%+A%,Y7%)
10680 NEXT A
10690 RETURN

'DIRECIONA mudança entre telas
'ESQUERDA
 10700 IF TL%=5 THEN X%=232:GOTO 10600  'TELA 2
 10710 IF TL%=6 THEN GOTO 10605         'TELA 3
 10711 IF TL%=8 THEN X%=232:GOTO 10570         'TELA 1

'DIREITA
 10712 IF TL%=7 THEN X%=8:GOTO 10600    'TELA 2
 10713 IF TL%=6 THEN X%=8:GOTO 10570         'TELA 1
 10714 IF TL%=5 THEN GOTO 11100         'TELA 3

'===> BAT
10720 IF TIME-T4%<6 THEN RETURN
10730 T4%=TIME
10740 IF S4%>=28 AND S4%<32 THEN S4%=S4%+1 ELSE S4%=29 
10750 IF X4%>=230 THEN D4%=-1
10760 IF X4%<=200 THEN D4%=1
10770 X4%=X4%+D4%
10780 PUT SPRITE 4,(X4%,Y4%),12,S4%
10790 RETURN

'===> BAT 2
10800 IF TIME-T5%<3 THEN RETURN
10810 T5%=TIME
10820 IF S5%>=29 AND S5%<32 THEN S5%=S5%+1 ELSE S5%=23 
10830 IF X5%>=220 			THEN D5%=-2
10840 IF X5%<=10  			THEN D5%=2
10850 IF Y5%<=LS5% 			THEN DY%=1 
10860 IF Y5%>=LM5% 			THEN DY%=-1 '145
10870 Y5%=Y5%+DY%:X5%=X5%+D5%
10880 PUT SPRITE 5,(X5%,Y5%),5,S4%
10890 RETURN

'==== CARANGUEJO
10900 IF TIME-T11%<20 THEN RETURN
10910 T11%=TIME
10940 IF D11%=-1 THEN GOSUB 10973 ELSE GOSUB 10980 'GOSUB 10971  'EXIBE CARANGUEJO
10950 X11%=X11%+D11%
10960 IF S11%=1 THEN S11%=0:TL11%=182 ELSE S11%=1:TL11%=184
10966 GOSUB 11000 'VER COLISÃO 
10970 RETURN
'==== VÁ PARA ESQUERDA
'10973 IF TILE(X11%,Y11%)=164 OR TILE(X11%,Y11%)=170   THEN D11%=1:RETURN 'TEM ALGO NA FRENTE
10973 IF TILE(X11%,Y11%)<>0   THEN D11%=1:RETURN 'TEM ALGO NA FRENTE
10974 PUT TILE TL11%,(X11%,Y11%):PUT TILE TL11%+1,(X11%+1,Y11%):PUT TILE 0,(X11%+2,Y11%) 
10975 RETURN 
'==== VÁ PARA DIREITA
'10980 IF TILE(X11%+2,Y11%)=164  THEN D11%=-1:RETURN 'TEM ALGO NA FRENTE
10980 IF TILE(X11%+2,Y11%)<>0  THEN D11%=-1:RETURN 'TEM ALGO NA FRENTE
10988 PUT TILE 0,(X11%,Y11%):PUT TILE TL11%,(X11%+1,Y11%) :PUT TILE TL11%+1,(X11%+2,Y11%)
10989 RETURN 
'==== COLISÃO CARANGUEJO
11000 CT%=TILE(X%/8,TY%-1)
11020 IF CT%>=182  AND CT%<=185  THEN GOSUB 5000 'GOSUB 10100 'reduz coração
11030 RETURN

'==== COLISÃO MOEDA

 11040 FOR A%=0 TO 1
 11043      IF TILE(RX%+A%,RY%-2)=147 THEN PUT TILE 0,(RX%+A%,RY%-2):GOSUB 3200 'PONTUA MOEDA
 11044 NEXT A%
 11045 RETURN

' 11040 FOR A%=0 TO 1:PTX%=RX%+A%:PTY%=RY%-2:GOSUB 11050:NEXT A
' 11045 RETURN

 '11050 XX%=TILE(PTX%,PTY%)
 '11055 IF XX%>=147 AND XX%<=150 THEN O6%=0:PUT TILE 0,(PTX%,PTY%):SC%=SC%+10:LOCATE 20,23: PRINT "PONTOS: " + SC%:RETURN
 '11055 IF XX%=147 THEN PUT TILE 0,(PTX%,PTY%):GOSUB 3200 'PONTUA MOEDA
 '11060 RETURN

'ALAVANCA ESQUERDA
11070 IF DX%<0 THEN PUT TILE   0,(RX%-1,Y%/8+1) ELSE PUT TILE   0,(RX%+2,Y%/8+1)
11071 IF DX%<0 THEN PUT TILE 203,(RX%-1,Y%/8+2) ELSE PUT TILE 219,(RX%+2,Y%/8+2)
' 11070 PUT TILE   0,(RX%-1,Y%/8+1)
' 11071 PUT TILE 203,(RX%-1,Y%/8+2)
'11073 SE%=0:AP%=1:GOSUB 3110
11073 AP%=1:GOSUB 3110
11074 RETURN

'ABRE BAÚ
11080 GOSUB 11086 'ZERA A CHAVE ATIVA
11081 FOR A%=1 TO 2:PUT TILE   0,(RX%+3,RY%-A%):PUT TILE   0,(RX%+4,RY%-A%):NEXT A%
11082 PUT TILE 222,(RX%+2,RY%-3):PUT TILE 223,(RX%+3,RY%-3)
11085 RETURN

'UTILIZA A CHAVE
11086 FM%=0:PUT TILE 0,(30,2):RETURN


'11040 '===> COLISÃO DE SPRITES
'11045 DT8%=TIME-T8%:IF DT8%<5 THEN RETURN
'11050 T8%=TIME
'11055 IF COLLISION(0, 5)>0 THEN GOSUB 10100:RETURN              'BAT 2
'11060 IF COLLISION(0, 3)>0 THEN GOSUB 10100:GOSUB 10200: RETURN 'FOGO 
'11065 GOSUB 10020 'VERIFICA COLISÃO DE TILE
'11070 RETURN

'******************************************************************************
'==== GOTEIRA
'******************************************************************************
7000 IF TIME-T13%<LT% THEN RETURN ELSE T13%=TIME
7010 IF F1%=0 THEN F1%=1:TG%=193:GOSUB 8000:RETURN
7020 IF F1%=1 THEN F1%=2:TG%=194:GOSUB 8000:RETURN
7030 IF F1%=2 THEN F1%=4:TG%=195:GOSUB 8000:RETURN
7040 IF F1%=4 THEN LT%=10:F1%=5:Y13%=Y13%+1:GOSUB 8000:RETURN
7045 IF F1%=5 THEN Y13%=Y13%+1:GOSUB 8000:RETURN   'CAINDO
7046 IF F1%=6 THEN TG%=196:GOSUB 8000:F1%=7:RETURN 'COLIDIU
7047 IF F1%=7 THEN TG%=0:GOSUB 8000:F1%=0:Y13%=MY13%:LT%=30:RETURN


' 7010 IF F1%=0 THEN TG%=193
' 7020 IF F1%=1 THEN TG%=194
' 7030 IF F1%=2 THEN TG%=195
' 7040 IF F1%=4 THEN LT%=10:Y13%=Y13%+1
' 7045 IF F1%=5 THEN Y13%=Y13%+1
' 7046 IF F1%=6 THEN TG%=196 
' 7047 IF F1%=7 THEN TG%=0:GOSUB 8000:F1%=0:Y13%=6:LT%=30
' 7048 IF F1%<>5 AND F1%<>7  THEN F1%=F1%+1
' 7049 GOSUB 8000
7050 RETURN

'=== FANTASMINHA  --- EXIBE GOTEIRA
8000 PUT TILE TG%,(X13%,Y13%)':LOCATE 0,0:PRINT F1%,TG%
8012 IF F1%=5 THEN  PUT TILE 0,(X13%,Y13%-1):GOSUB 8100 'APAGA RASTRO QDO ESTÁ CAINDO
8013 IF TILE(X13%,Y13%+1)<>0 THEN F1%=6      'COLISÃO COM O CHÃO
8090 RETURN
'=== COLISAO
8100 '
8101 CT%=TILE(X%/8,TY%-3)':LOCATE 0,1:PRINT CT%
8102 A%=X%/8:CK%=TILE(A%+1,TY%-3)':LOCATE 0,2:PRINT A%+1
8110 IF CT%=195 OR CK%=195 THEN F1%=6:GOTO 7046 'GOSUB 10100 'reduz coração
8120 RETURN
'******************************************************************************

'******************************************************************************
'=== ALIEN
'******************************************************************************
8200 '
8210 IF TIME-T10%<8 THEN RETURN ELSE T10%=TIME
8230 IF S10%=MS10%+1 THEN S10%=MS10% ELSE S10%=MS10%+1
8240 MD10%=D10%
8250 IF TILE (X10%/8+1,Y10%/8+2)=164 THEN D10%=D10% * -1
8270 X10%=X10%+D10%
8280 IF MD10%<>D10% THEN SET SPRITE FLIP 35,0:SET SPRITE FLIP 36,0:MD10%=D10%
8290 PUT SPRITE 6,(X10%,Y10%),CL10%,S10%
8300 RETURN

' 8200 '
' 8210 IF TIME-T10%<8 THEN RETURN ELSE T10%=TIME
' 8230 IF S10%=36 THEN S10%=35 ELSE S10%=36
' 8240 MD10%=D10%
' 8250 IF X10%<=140 THEN D10%=3
' 8260 IF X10%>=230 THEN D10%=-3
' 8270 X10%=X10%+D10%
' 8280 IF MD10%<>D10% THEN SET SPRITE FLIP 35,0:SET SPRITE FLIP 36,0:MD10%=D10%
' 8290 PUT SPRITE 6,(X10%,Y10%),12,S10%
' 8300 RETURN

'******************************************************************************
'==== FANSTASMINHA
'******************************************************************************

8400 IF TIME-T15%<5 THEN GOTO 8405 ELSE T15%=TIME
8401 IF C14%<>15 THEN C14%=15 ELSE C14%=0
8402 FOR A%=197 TO 198
8403    SET TILE COLOR A%,C14%
8404 NEXT A%

8405 IF TIME-T14%<10 THEN RETURN ELSE T14%=TIME
8415 IF D14%=-1 THEN GOSUB 8440 ELSE GOSUB 8455 'GOSUB 10971  'EXIBE FANSTASMINHA
8420 X14%=X14%+D14%
8425 IF S14%=1 THEN S14%=0 ELSE S14%=1
'8430 GOSUB 11000 'VER COLISÃO 
8435 RETURN
'==== VÁ PARA ESQUERDA
8440 IF TILE(X14%,Y11%)<>0 OR TILE(X14%,Y11%-1)<>0 THEN D14%=1:RETURN 'TEM ALGO NA FRENTE
8447 PUT TILE 0     ,(X14%+1,Y14%) 
8448 PUT TILE 0     ,(X14%+1,Y14%+1) 
8445 PUT TILE 197   ,(X14%,Y14%)
8446 PUT TILE 198   ,(X14%,Y14%+1)
8450 RETURN 
'==== VÁ PARA DIREITA
8455 IF TILE(X14%+1,Y11%)<>0 OR TILE(X14%+1,Y11%-1)<>0 THEN D14%=-1:RETURN 'TEM ALGO NA FRENTE
8460 PUT TILE 0     ,(X14%,Y14%)
8461 PUT TILE 0     ,(X14%,Y14%+1)
8462 PUT TILE 197   ,(X14%+1,Y14%) 
8463 PUT TILE 198   ,(X14%+1,Y14%+1)
8465 RETURN 
 
'==== COLISÃO FANSTASMINHA
'8470 CT%=TILE(X%/8,TY%-1)
'8475 IF CT%>=182  AND CT%<=185  THEN GOSUB 5000 'GOSUB 10100 'reduz coração
'8480 RETURN
'******************************************************************************

'=== ESPETOS
8500 IF TIME-T14%<15 THEN RETURN ELSE T14%=TIME
8501 IF EP%=200 THEN  EP%=199 ELSE EP%=200
8502 PUT TILE EP%,(XES%,YES%)
8503 RETURN